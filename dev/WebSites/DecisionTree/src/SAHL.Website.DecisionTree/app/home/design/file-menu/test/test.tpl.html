<div class="childView">
    <div class="row1">
        <h1>Test</h1>
        <h2>{{document.data.name}}</h2>
        <br />
    </div>
    <div class="row2">
        <div class="tab-container">
            <ul class="tabs-list">
                <li ng-class="{active: currentTab==='test-suite'}"><a ng-click="currentTab='test-suite'" href="">Test-Suite</a></li>
                <li ng-class="{active: currentTab==='test-variables'}"><a ng-click="currentTab='test-variables'" href="">Test-Variables</a></li>
                <li ng-class="{active: currentTab==='test-coverage'}"><a ng-click="currentTab='test-coverage'" href="">Test-Coverage</a></li>
                <button ng-show="!isExecuting" class="place-right" ng-click="runAllTests()">Run All Tests</button>
                <span>&nbsp;</span>
                <button ng-show="isExecuting" class="place-right" ng-click="cancelAllTests()">Cancel All Tests</button>
            </ul>
            <div id="scrollBox" class="coverage-scroller" spin-loader="loadingTestData">
                <div ng-show="currentTab==='test-suite'" class="tab-item">
                    <form name="testCasesForm">
                        <div class="run-button-container">
                            <div class="button-set-container">
                                <div class="button-set place-right">
                                    <button ng-click="addNewStory()">Add Test Story</button>
                                </div>
                            </div>
                        </div>
                        <div id="testCases" class="accordion with-marker table-container " data-role="accordion" ng-repeat="testCase in testCases">
                            <div class="accordion-frame">
                                <div class="heading" ng-class="testCase.$passFailClass">
                                    <span class="editableGroupName" contenteditable ng-model="testCase.name" strip-br="true" />
                                    <a class="place-right icons-column runTests" ng-class="scenario.$passFailClass" href="" ng-click="removeTestStory($index,$event)"><i class="icon-cancel"></i>Remove</a>
                                    <span class="place-right">&nbsp;</span>
                                    <a ng-show="!testCase.$executing" class="place-right icons-column runTests" ng-class="testCase.$passFailClass" ng-click="runScenarios(testCase.id, $event)" href=""><i class="icon-play"></i>Run Tests</a>
                                    <a ng-show="testCase.$executing" class="place-right icons-column" ng-class="testCase.$passFailClass" ng-click="cancelTests(testCase.id, $event)" href=""><i class="icon-cancel"></i>Cancel</a>
                                    <span class="place-right" ng-class="testCase.$passFailClass" style="margin-right:10px;" href="">{{testCase.$executing?'Running':'Ran'}} {{testCase.$completed||0}} of {{testCase.scenarios.length || 0}} | {{testCase.$successes||0}} Passed | {{testCase.$failures||0}} Failed | </span>
                                    <div ng-show="testCase.$executing" class="progress-bar small" data-animate="animate" data-role="progress-bar" data-color="bg-green" data-value="{{testCase.$progressValue}}" id="{{'progressbar' + testCase.id}}"></div>
                                </div>
                                <div class="content">
                                    <table class="table bordered" ng-form="defaultInputs">
                                        <tbody>

                                            <tr class="subgroupRow">
                                                <td colspan="3">Default Input Values</td>
                                            </tr>
                                            <tr ng-repeat="inputValue in testCase.input_values" style="width:50%">
                                                <td>
                                                    <label>{{inputValue.name}}</label>
                                                </td>
                                                <td ng-if="!inputValue.$isEnum" style="width:50%">
                                                    <div class="input-control text" ng-if="inputValue.$inputType=='text'">
                                                        <input type="text" ng-model="inputValue.value" name="{{inputValue.name}}" ng-class="{invalid: inputValue.$treeValueNotDefined}" />
                                                    </div>
                                                    <div class="input-control text" ng-if="inputValue.$inputType=='number' && inputValue.type==='int'">
                                                        <input type="text" is-number="int" ng-model="inputValue.value" name="{{inputValue.name}}" ng-class="{invalid: inputValue.$treeValueNotDefined}" />
                                                    </div>
                                                    <div class="input-control text" ng-if="inputValue.$inputType=='number' && (inputValue.type==='float'||inputValue.type==='double')">
                                                        <input type="text" is-number="float" ng-model="inputValue.value" name="{{inputValue.name}}" ng-class="{invalid: inputValue.$treeValueNotDefined}" />
                                                    </div>
                                                    <div class="input-control select" ng-if="inputValue.$inputType=='bool'">
                                                        <select ng-model=" inputValue.value" ng-options="v for v in boolSelect" name="{{inputValue.name}}" ng-class="{invalid: inputValue.$treeValueNotDefined}"></select>
                                                    </div>
                                                </td>
                                                <td ng-if="inputValue.$isEnum" style="width:50%">
                                                    <div class="input-control select">
                                                        <select ng-class="{invalid: inputValue.$treeValueNotDefined}"
                                                                ng-options="availableEnumeration.name as availableEnumeration.value for availableEnumeration in inputValue.$enums"
                                                                ng-model="inputValue.value"
                                                                ng-init="inputValue.value = inputValue.value || ( inputValue.$enums.length > 0 ? inputValue.$enums[0] : '')"></select>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div class="button-set-container">
                                        <div class="button-set place-right">
                                            <button ng-click="addScenario(testCase.id)">Add New Scenario</button>
                                        </div>
                                    </div>
                                    <div class="accordion with-marker table-container" ng-repeat="scenario in testCase.scenarios">
                                        <div class="accordion-frame">
                                            <div class="heading" ng-class="scenario.$passFailClass">
                                                <span contenteditable class="editableGroupName" ng-model="scenario.name" strip-br="true" />
                                                <i class="text-alert icon-warning" title="Values are missing for tree inputs." ng-show="scenario.$treeValueNotDefined"></i>
                                                <a ng-disable="testCase.$executing" class="place-right icons-column" ng-class="scenario.$passFailClass" ng-click="debugScenario($parent.$index, $index, $event)" href=""><i class="icon-play"></i>Debug</a>
                                                <span class="place-right">&nbsp;</span>
                                                <span class="place-right">&nbsp;</span>
                                                <a class="place-right icons-column" ng-class="scenario.$passFailClass" href="" ng-click="removeScenario($parent.$index, $index)"><i class="icon-cancel"></i>Remove</a>
                                            </div>
                                            <div class="content">
                                                <table class="table bordered">
                                                    <tbody>
                                                        <tr class="subgroupRow">
                                                            <td colspan="5">Given :</td>
                                                            <td class="icons-column"><a href="" ng-click="addInput($parent.$index, $index)"><i class="icon-plus-2"></i> Add Input</a>
                                                        </tr>
                                                        <tr ng-repeat="inputValue in scenario.input_values">
                                                            <td>
                                                                <label for="{{inputValue.name}}">{{inputValue.name}}</label>
                                                            </td>
                                                            <td>
                                                                of
                                                            </td>
                                                            <td ng-if="!inputValue.$isEnum" colspan="3">
                                                                <div class="input-control text" ng-if="inputValue.$inputType=='text'">
                                                                    <input type="text" ng-model="inputValue.value" name="{{inputValue.name}}" ng-class="{invalid: inputValue.$treeValueNotDefined}" />
                                                                </div>
                                                                <div class="input-control text" ng-if="inputValue.$inputType=='number' && inputValue.type==='int'">
                                                                    <input type="text" is-number="int" ng-model="inputValue.value" name="{{inputValue.name}}" ng-class="{invalid: inputValue.$treeValueNotDefined}" />
                                                                </div>
                                                                <div class="input-control text" ng-if="inputValue.$inputType=='number' && (inputValue.type==='float'||inputValue.type==='double')">
                                                                    <input type="text" is-number="float" ng-model="inputValue.value" name="{{inputValue.name}}" ng-class="{invalid: inputValue.$treeValueNotDefined}" />
                                                                </div>
                                                                <div class="input-control select" ng-if="inputValue.$inputType=='bool'">
                                                                    <select ng-model="inputValue.value" ng-options="v for v in boolSelect"></select>
                                                                </div>
                                                            </td>
                                                            <td ng-if="inputValue.$isEnum" colspan="3">
                                                                <div class="input-control select">
                                                                    <select ng-class="{invalid: inputValue.$treeValueNotDefined}"
                                                                            ng-options="availableEnumeration.name as availableEnumeration.value for availableEnumeration in inputValue.$enums"
                                                                            ng-model="inputValue.value"
                                                                            ng-init="inputValue.value = inputValue.value || ( inputValue.$enums.length > 0 ? inputValue.$enums[0] : '')"></select>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <a href="" ng-click="removeInput($parent.$parent.$index, $parent.$index, inputValue.id)"><i class="icon-cancel"></i> Remove</a>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                    <tbody>
                                                        <tr class="subgroupRow">
                                                            <td>Expect outputs:</td>
                                                            <td style="width:120px;"></td>
                                                            <td style="width:10%;">Type</td>
                                                            <td style="width:30%;">Expected</td>
                                                            <td style="width:30%;">Actual</td>
                                                            <td><a href="" ng-click="addOutput($parent.$index, $index)"><i class="icon-plus-2"></i> Add Output</a></td>
                                                        </tr>
                                                        <tr ng-repeat="outputValue in scenario.output_values">
                                                            <td>Expect {{outputValue.name}}</td>
                                                            <td>
                                                                <div class="input-control select">
                                                                    <select ng-options="assertion for assertion in assertions"
                                                                            ng-model="outputValue.assertion"
                                                                            ng-init="outputValue.assertion = outputValue.assertion || (assertions.length > 0 ? assertions[0] : '')"></select>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="input-control select">
                                                                    <select ng-options="outputExpectationType for outputExpectationType in outputExpectationTypes"
                                                                            ng-model="outputValue.expectationType"
                                                                            ng-init="outputValue.expectationType = outputValue.expectationType || (outputExpectationTypes.length > 0 ? outputExpectationTypes[0] : '')"
                                                                            ng-change="outputValue.$update()"></select>
                                                                </div>
                                                            </td>
                                                            <td ng-if="!outputValue.$isEnum && outputValue.expectationType == 'inline'">
                                                                <div class="input-control text" ng-if="outputValue.$inputType=='text'">
                                                                    <input type="text" ng-model="outputValue.value" name="{{outputValue.name}}" ng-class="{invalid: outputValue.$success===false}" />
                                                                </div>
                                                                <div class="input-control text" ng-if="outputValue.$inputType=='number' && outputValue.type==='int'">
                                                                    <input type="text" is-number="int" ng-model="outputValue.value" name="{{outputValue.name}}" ng-class="{invalid: outputValue.$success===false}" />
                                                                </div>
                                                                <div class="input-control text" ng-if="outputValue.$inputType=='number' && (outputValue.type==='float'||outputValue.type==='double')">
                                                                    <input type="text" is-number="float" ng-model="outputValue.value" name="{{outputValue.name}}" ng-class="{invalid: outputValue.$success===false}" />
                                                                </div>
                                                                <div class="input-control select" ng-if="outputValue.$inputType=='bool'">
                                                                    <select ng-model=" outputValue.value" ng-options="v for v in boolSelect" name="{{outputValue.name}}" ng-class="{invalid: outputValue.$success===false}"></select>
                                                                </div>
                                                            </td>
                                                            <td ng-if="outputValue.$isEnum && outputValue.expectationType == 'inline'">
                                                                <div class="input-control select">
                                                                    <select ng-class="{invalid: outputValue.$success===false}"
                                                                            ng-options="availableEnumeration.name as availableEnumeration.value for availableEnumeration in outputValue.$enums"
                                                                            ng-model="outputValue.value"
                                                                            ng-init="outputValue.value = outputValue.value || ( outputValue.$enums.length > 0 ? outputValue.$enums[0] : '')"></select>
                                                                </div>
                                                            </td>
                                                            <td ng-if="outputValue.expectationType === 'test-variable'">
                                                                <div class="input-control select">
                                                                    <select ng-options="variable.id as variable.name + ' (' + variable.value + ')' for variable in document.data.testVariables"
                                                                            ng-model="outputValue.value"
                                                                            ng-init="outputValue.value = outputValue.value || ( document.data.testVariables.length > 0 ? document.data.testVariables[0].id : '')"
                                                                            ng-change="validate(outputValue.value)"></select>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="input-control text">

                                                                    <input type="text" ng-class="{invalid: outputValue.$success===false}" readonly ng-model="outputValue.$actualDisplayValue" name="{{outputValue.name + 'Actual'}}" />

                                                                </div>
                                                            </td>
                                                            <td>
                                                                <a href="" ng-click="removeOutput($parent.$parent.$index, $parent.$index, outputValue.id)"><i class="icon-cancel"></i> Remove</a>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                    <tbody>
                                                        <tr class="subgroupRow">
                                                            <td>Expect messages:</td>
                                                            <td style="width:155px;"></td>
                                                            <td colspan="3">Expected</td>

                                                            <td>
                                                                <a href="" ng-click="addMessageOutput($parent.$index, $index)"><i class="icon-plus-2"></i> Add Message</a>
                                                            </td>
                                                        </tr>
                                                        <tr ng-repeat="outputMessage in scenario.output_messages">
                                                            <td>
                                                                <div class="input-control select">
                                                                    <select ng-class="{invalid: outputValue.$success===false}"
                                                                            ng-options="messageCollection for messageCollection in messageCollections"
                                                                            ng-model="outputMessage.messageCollection"
                                                                            ng-init="outputMessage.messageCollection = outputMessage.messageCollection || (messageCollections.length > 0 ? messageCollections[0] : '')"></select>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="input-control select">
                                                                    <select ng-options="assertion for assertion in messageAssertions"
                                                                            ng-model="outputMessage.assertion"
                                                                            ng-init="outputMessage.assertion = outputMessage.assertion || (messageAssertions.length > 0 ? messageAssertions[0] : '')"
                                                                            ng-change="outputMessage.$update()"></select>
                                                                </div>
                                                            </td>

                                                            <td colspan="3">
                                                                <div class="input-control text">
                                                                    <input type="text" class="scenario-message-output-input" ng-class="{invalid: outputMessage.$success===false}" ng-model="outputMessage.message.value" name="{{outputMessage.message.name}}" ng-disabled="outputMessage.assertion === 'should be empty'" />
                                                                    <a class="scenario-message-output-link" href="" ng-click="selectMessage($parent.$parent.$index, $parent.$index, outputMessage)" ng-hide="outputMessage.assertion === 'should be empty'"><i class=" icon-plus-2"></i>Select Message</a>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <a href="" ng-click="removeMessageOutput($parent.$parent.$index, $parent.$index, outputMessage.message.name)"><i class="icon-cancel"></i> Remove</a>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                    <tbody>
                                                        <tr class="subgroupRow">
                                                            <td>Expect Subtrees:</td>
                                                            <td style="width:155px;"></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td>Actual</td>
                                                            <td>
                                                                <a href="" ng-click="addSubtreeExpectation($parent.$index, $index)"><i class="icon-plus-2"></i> Add Subtree</a>
                                                            </td>
                                                        </tr>
                                                        <tr ng-repeat="subtree in scenario.subtrees">
                                                            <td>Expect that "{{subtree.name}}"</td>
                                                            <td colspan="3">
                                                                <div class="input-control select">
                                                                    <select ng-options="subtreeAssertion for subtreeAssertion in subtreeAssertions"
                                                                            ng-model="subtree.assertion"
                                                                            ng-init="subtree.assertion = subtree.assertion || (subtreeAssertions.length > 0 ? subtreeAssertions[0] : '')"></select>
                                                                </div>
                                                            </td>
                                                            <td>
                                                                <div class="input-control text">

                                                                    <input type="text" ng-class="{invalid: subtree.$success===false}" readonly ng-model="subtree.$assertionResult" name="{{subtree.name + 'Actual'}}" />

                                                                </div>
                                                            </td>
                                                            <td>
                                                                <a href="" ng-click="removeSubtreeExpectation($parent.$parent.$index, $parent.$index, subtree.name)"><i class="icon-cancel"></i> Remove</a>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div ng-show="currentTab==='test-variables'" class="tab-item">
                    <table class="table bordered">
                        <tbody>
                            <tr class="subgroupRow">
                                <td colspan="2">Test Output Variables</td>
                                <td class="icons-column"><a href="" ng-click="addTestVariable()"><i class="icon-plus-2"></i> Add Variable</a>
                            </tr>
                            <tr ng-repeat="testVariable in document.data.testVariables">
                                <td>
                                    <label for="{{testVariable.name}}">{{testVariable.name}}</label>
                                </td>
                                <td ng-if="!testVariable.$isEnum">
                                    <div class="input-control text" ng-if="testVariable.$inputType=='text'">
                                        <input type="text" ng-model="testVariable.value" name="{{testVariable.name}}" ng-class="{invalid: testVariable.$treeValueNotDefined}" />
                                    </div>
                                    <div class="input-control text" ng-if="testVariable.$inputType=='number' && testVariable.type==='int'">
                                        <input type="text" is-number="int" ng-model="testVariable.value" name="{{testVariable.name}}" ng-class="{invalid: testVariable.$treeValueNotDefined}" />
                                    </div>
                                    <div class="input-control text" ng-if="testVariable.$inputType=='number' && (testVariable.type==='float'||testVariable.type==='double')">
                                        <input type="text" is-number="float" ng-model="testVariable.value" name="{{inputValue.name}}" ng-class="{invalid: testVariable.$treeValueNotDefined}" />
                                    </div>
                                    <div class="input-control select" ng-if="testVariable.$inputType=='bool'">
                                        <select ng-model="testVariable.value" ng-options="v for v in boolSelect"></select>
                                    </div>
                                </td>
                                <td ng-if="testVariable.$isEnum">
                                    <div class="input-control select">
                                        <select ng-class="{invalid: testVariable.$treeValueNotDefined}"
                                                ng-options="availableEnumeration.name as availableEnumeration.value for availableEnumeration in testVariable.$enums"
                                                ng-model="testVariable.value"
                                                ng-init="testVariable.value = testVariable.value || ( testVariable.$enums.length > 0 ? testVariable.$enums[0] : '')"></select>
                                    </div>
                                </td>
                                <td>
                                    <a href="" ng-click="removeTestVariable(testVariable)"><i class="icon-cancel"></i> Remove</a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div ng-show="currentTab==='test-coverage'" class="tab-item">
                    <table class="table bordered">
                        <thead>
                            <tr>
                                <th>Node name</th>
                                <th>Node type</th>
                                <th>Number of links</th>
                                <th>Number of covered links</th>
                                <th>Coverage percentage</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-class="hasTestResult ? (nodeData.totalCoverage === 100 ? 'coverage-green': 'coverage-orange') : 'coverage-none'">
                                <td><label><strong>Total</strong></label></td>
                                <td><label><strong>All</strong></label></td>
                                <td><label><strong>{{nodeData.numberOfLinks}}</strong></label></td>
                                <td><label><strong>{{nodeData.coveredLinks.length}}</strong></label></td>
                                <td class="coverage-percent-col"><label><strong>{{nodeData.totalCoverage | number:2}}%</strong></label></td>
                            </tr>
                        </tbody>
                        <tbody ng-repeat="node in nodeData.nodes">
                            <tr ng-class="hasTestResult ? (node.coveragePercentage === 100 ? 'coverage-green': 'coverage-orange') : 'coverage-none'">
                                <td><label>{{node.name}}</label></td>
                                <td><label>{{node.type}}</label></td>
                                <td><label>{{node.links.length}}</label></td>
                                <td><label>{{node.numberOfCoveredLinks()}}</label></td>
                                <td class="coverage-percent-col"><label>{{node.coveragePercentage}}%</label></td>
                            </tr>
                            <tr>
                                <td colspan="5" id="inner-row">
                                    <table id="coverage-inner-table">
                                        <tbody ng-repeat="link in node.links">
                                            <tr ng-class="link.isCovered === true ? 'coverage-green' : 'coverage-orange'">
                                                <td id="coverage-row-spacer"></td>
                                                <td><label>({{link.type}}) - {{link.name}}</label></td>
                                                <td class="coverage-percent-col"><label>{{link.isCovered}}</label></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
