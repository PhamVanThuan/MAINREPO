<div ng-controller="Wizards_ThirdParty_Invoice_ThirdPartyInvoiceCaptureWizardPageStateCtrl as vm" id="invoice_capture_or_amend_wizard">
<span class="mif-icon_name" spin-loader="loading">
 <div class="documentHeadContainer grid">
    <div class="headerText">
        Received From <b>{{invoice.receivedFromEmailAddress}}</b> on the <b>{{invoice.receivedDate| dateViewFilter}}</b>
    </div>
    <div class="row noTopMargin">
      <div class="span7">
        <div class="labels">
          <div>SAHL Reference:</div>
          <div>Account Number:</div>
          <div>Client:</div>
        </div>
        <div class="values">
          <div>{{invoice.sahlReference | emptyStringDecorator}}</div>
          <div>{{invoice.accountKey | emptyStringDecorator}}</div>
          <div>{{invoice.clientName | emptyStringDecorator}}</div>
        </div>
      </div>
      <div class="span7">
        <div class="labels">
          <div>Loss Control Stage:</div>
          <div>SPV:</div>
        </div>
         <div class="values">
             <div>{{stageInLossControl | emptyStringDecorator}} </div>
             <div>{{spvDescription | emptyStringDecorator}} </div>
         </div>
      </div>
      <div class="pdfLinkContainer span2" ng-show="invoiceDocument != null">
          <div class="pdf-icon" ng-click="loadDocument(invoiceDocument.id)"></div>
      </div>
    </div><!-- end row -->
  </div>

  <div class="panelH150 smartColumns grid">
    <h2>Capture the details below from the invoice document</h2>
    <div class="row noTopMargin">
      <div class="span7">
         <div>
          <div class="labels" style="margin-right:25px">
            <div class="marginB5" style="">Attorney:</div>
            <div>Invoice Date:</div>          
          </div>

          <div class="values">
            <div class="marginB5">
              <select class="field" ng-model="selectedThirdParty" ng-options="thirdParty.id as thirdParty.legalName for thirdParty in thirdParties">     
                  <option value="">--Select--</option>
              </select>
              
            </div>
            <div id ="datepicker" class="datepicker"
                 date-format="dd/MM/yyyy"
                 date-max-limit="{{maximumCalendarDate}}"
                 button-prev='<i class="fa fa-arrow-circle-left"></i>'
                 button-next='<i class="fa fa-arrow-circle-right"></i>'>
                <input ng-model="invoice.invoiceDate" type="text" class="angular-datepicker-input field"/>
             </div>
          </div>
        </div>

        <div style="clear: both;" ng-show="canInvoiceBeCapitalised">
            <div class="labels" style="margin-right: 12px;margin-top: 3px;">
              <div class="marginB5">Capitalise Fees:</div>
            </div>
            <div class="values">
                <div class="marginB5">
                  <label class="input-control checkbox small-check" style="margin: 3px 0 0 0;">
                    <input editable=false type="checkbox" ng-model="invoice.capitaliseInvoice">
                    <span class="check"></span>
                  </label>            
               </div>
            </div>
        </div>
      </div>

      <div class="span7">
          <div class="labels">
            <div class="marginB5">Payment Reference:</div>
            <div class="marginB5">Invoice Number:</div>
          </div>
          <div class="values">
            <div class="marginB5"><input class="field" type="text" ng-model="invoice.paymentReference" maxlength="30" /></div>
            <div class="marginB5"><input class="field" type="text" ng-model="invoice.invoiceNumber" maxlength="50" /></div>
          </div>
      </div>
    </div>
  </div>
          
   <!--UI Grid -->  
   <div class="gridTotal">
     Invoice Total: {{invoiceTotal | currencyFilter:2}}
   </div>
  <div ui-grid="invoiceGrid"
        ui-grid-grouping 
        ui-grid-pinning
        ui-grid-edit
        ui-grid-selection
        ui.grid.cellNav class="grid"
        spinner-key="spinnerGrid" spinner-start-active="true"></div>
    <div class="buttons">
      <div class="toolbar">
        <div class="toolbar-group fg-orange">
          <button ng-click="addRow()" title="Add a row"><i class="icon-plus-2"></i></button>
          <button ng-click="deleteSelected()" title="Remove selected row" ng-show="isRowSelected"><i class="icon-minus-2"></i></button>
        </div>
      </div>
      <div class="right">
        <button class="button small-button" ng-click="captureThirdPartyInvoice()" ng-disabled="cannotSave">Finish</button> | <button class="button small-button" ng-click="cancelThirdPartyInvoiceCapture()">Cancel</button>
      </div>
    </div>   
</span>
</div>
<!-- Dialog HTML -->
<script type="text/ng-template" id="invoiceLineItemModal.html">
    <form class="user-input">
      <label>Type:</label>
      <div ng-class="{'input-control select warning-state': vm.invalidType, 'input-control select': !vm.invalidType}"  
          class="input-control select">
        <select type="text" ng-model="vm.type"
          ng-options="option.id as option.description for option in vm.invoiceTypes"
          ng-change="vm.setDescriptions(vm.type)">
            <option value="">--Select--</option>
        </select>
      </div>

      <label>Description:</label>
      <div ng-class="{'input-control select warning-state': vm.invalidDescription, 'input-control select': !vm.invalidDescription}"  
          class="input-control select">
        <select type="text" 
         ng-disabled="vm.type == null"
         ng-model="vm.description"
          ng-options="option.id as option.description for option in vm.descriptionOptions">
          <option value="">--Select--</option>
        </select>
      </div>

      <label>Amount:</label>
      <div ng-class="{'input-control text warning-state': vm.invalidAmount, 'input-control text': !vm.invalidAmount}"  
            class="input-control text">
        <input type="text" ng-model="vm.entity.lineItemAmount" class="input-control text" placeholder="Amount" />
      </div>

      <div class="input-control checkbox">
          <label>
            <input type="checkbox" ng-model="vm.entity.isVatable" />
            <span class="check"></span>
            Include VAT
          </label>
          <label ng-show="vm.isNewRow">
            <input type="checkbox" ng-model="vm.addAnotherNewRow" />
            <span class="check"></span>
            Add another line item
          </label>
      </div>

      
      <div class="form-actions">
          <button class="button" ng-click="vm.save()">Finish</button>
          <button class="button" ng-click="closeDialog()">Cancel</button>
      </div>
    </form>
</script>
