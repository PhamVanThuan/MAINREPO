using Machine.Fakes;
using Machine.Specifications;
using SAHL.Core.SystemMessages;
using SAHL.Services.Interfaces.FinanceDomain.Model;
using SAHL.Workflow.ThirdPartyInvoices;
using System;

namespace SAHL.WorkflowMaps.ThirdPartyInvoices.Specs.States.Loss_Control_Invoice_Received.OnEnter
{
    [Subject("State => Loss_Control_Invoice_Received => OnEnter")] // AutoGenerated
    public class when_setting_the_instance_subject : WorkflowSpecThirdPartyInvoices
    {
        private static bool result;
        private static IThirdPartyInvoiceWorkflowProcess process;
        private static GetThirdPartyInvoiceQueryResult dataModel;

        private Establish context = () =>
        {
            dataModel = new GetThirdPartyInvoiceQueryResult
            {
                ThirdPartyInvoiceKey = 1234,
                SahlReference = @"SAHL-2015\05\123",
                ThirdPartyId = Guid.NewGuid(),
                ThirdPartyRegisteredName = "Radles Inc",
                AccountKey = 12111,
                InvoiceStatusKey = 2,
                AmountExcludingVAT = 100.00m,
                VATAmount = 14.0M,
                TotalAmountIncludingVAT = 114.0M,
                ReceivedFromEmailAddress = "randles@randlesinc.com",
                InvoiceDate = DateTime.Now,
                InvoiceNumber = "SAHL780",
                ReceivedDate = DateTime.Now
            };
            process = An<IThirdPartyInvoiceWorkflowProcess>();
            process.WhenToldTo(x => x.GetThirdPartyInvoiceByThirdPartyInvoiceKey(Param.IsAny<ISystemMessageCollection>(), Param.IsAny<int>()))
                .Return(dataModel);
            domainServiceLoader.RegisterMockForType<IThirdPartyInvoiceWorkflowProcess>(process);
        };

        private Because of = () =>
            {
                string message = string.Empty;
                result = workflow.OnEnter_Loss_Control_Invoice_Received(instanceData, workflowData, paramsData, messages);
            };

        private It should_return_true = () =>
            {
                result.ShouldBeTrue();
            };
    }
}