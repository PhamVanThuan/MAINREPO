
using Microsoft.Scripting.Hosting;
using SAHL.Core.SystemMessages;
using Newtonsoft.Json;
using System.Collections.Generic;
using System.Linq;
using System;
using System.Reflection;
using System.Dynamic;
using SAHL.DecisionTree.Shared.Interfaces;
using SAHL.DecisionTree.Shared.Core;
using SAHL.DecisionTree.Shared.Helpers;

namespace SAHL.DecisionTree.Shared.Trees
{
    public class SAHomeLoansBCCScorecard_1 : IDecisionTree
    {
        private int currentNodeId;
        private bool currentResult;
        private ScriptScope scope;
        private bool nodeExecutionResultedInError;
        private dynamic variablesCollection;
        private ISystemMessageCollection systemMessageCollection;

        private Dictionary<string, ISystemMessageCollection> SubtreeMessagesDictionary { get; set; }
        private List<string> SubtreeMessagesToClear { get; set; }
        
        public List<Link> NodeLinks {get; private set;}
        public Dictionary<int, Node> Nodes {get; private set;}
        public QueryGlobalsVersion GlobalsVersion { get; protected set; }

        public SAHomeLoansBCCScorecard_1(ISystemMessageCollection messages)
        {
            this.NodeLinks = new List<Link>() { new Link(0,-3,-4,LinkType.Standard), new Link(1,1,-3,LinkType.Standard)};
            this.Nodes = new Dictionary<int, Node>() {{1, new Node(1,"Start",NodeType.Start,@"")},{-3, new Node(-3,"Calculate Score",NodeType.Process,@"# Extend short intput variable names from ITC XML into long data dictionary names for use in the score card logic below_newline_# this is done to make the logic human readable_newline__newline__newline_individual_age_all_industries = Variables::inputs.DM001AL_newline_deceasedindicatorallindustries = Variables::inputs.DM003AL_newline_deceased_indicator_all_industries = deceasedindicatorallindustries.to_s_newline_deceased_indicator_all_industries.upcase!_newline_number_of_enquiries_all_industries = Variables::inputs.EQ001AL_newline_number_of_enquiries_finance_houses_micro_loan = Variables::inputs.EQ001FC_newline_number_of_enquiries_finance_house_personal_loan = Variables::inputs.EQ001FL_newline_number_of_enquiries_general_appliances = Variables::inputs.EQ001GA_newline_number_of_enquiries_general_retail = Variables::inputs.EQ001GR_newline_number_of_enquiries_homeware = Variables::inputs.EQ001HW_newline_number_of_enquiries_jewelry = Variables::inputs.EQ001JW_newline_number_of_enquiries_other = Variables::inputs.EQ001OT_newline_number_of_enquiries_in_the_past_6_months_finance_houses_micro_loan = Variables::inputs.EQ003FC_newline_number_of_enquiries_in_the_past_6_months_finance_house_personal_loan = Variables::inputs.EQ003FL_newline_number_of_enquiries_in_the_past_12_months_general_appliances = Variables::inputs.EQ004GA_newline_number_of_enquiries_in_the_past_12_months_general_retail = Variables::inputs.EQ004GR_newline_number_of_enquiries_in_the_past_12_months_homeware = Variables::inputs.EQ004HW_newline_number_of_enquiries_in_the_past_12_months_jewelry = Variables::inputs.EQ004JW_newline_number_of_enquiries_in_the_past_12_months_other = Variables::inputs.EQ004OT_newline_number_of_defaults_all_industries = Variables::inputs.NG001AL_newline_number_of_judgments_all_industries = Variables::inputs.NG008AL_newline_total_amount_of_judgments_all_industries = Variables::inputs.NG011AL_newline_number_of_trades_all_industries = Variables::inputs.PP001AL_newline_number_of_trades_collection_agency = Variables::inputs.PP001CA_newline_number_of_open_trades_all_industries = Variables::inputs.PP003AL_newline_number_of_trades_opened_in_past_6_months_all_industries = Variables::inputs.PP005AL_newline_number_of_open_trades_as_of_12_months_ago_all_industries = Variables::inputs.PP011AL_newline_number_of_trades_3_months_or_worse_in_arrears_mortgage_bonds = Variables::inputs.PP046MB_newline_number_of_trades_3_months_or_worse_in_arrears_asset_finance = Variables::inputs.PP046VF_newline_number_of_trades_4_months_or_worse_in_arrears_finance_houses_micro_loan = Variables::inputs.PP047FC_newline_number_of_trades_4_months_or_worse_in_arrears_finance_house_personal_loan = Variables::inputs.PP047FL_newline_number_of_trades_4_months_or_worse_in_arrears_bank_micro_lenders = Variables::inputs.PP047NL_newline_number_of_trades_4_months_or_worse_in_arrears_personal_loans = Variables::inputs.PP047PL_newline_number_of_write_offs_or_repossessions_ever_all_industries = Variables::inputs.PP054AL_newline_age_of_oldest_open_trade_cellular = Variables::inputs.PP068CE_newline_total_monthly_payment_of_open_trades_all_industries = Variables::inputs.PP071AL_newline_total_monthly_payment_of_open_trades_as_of_12_months_ago_all_industries = Variables::inputs.PP074AL_newline_total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card = Variables::inputs.PP075CC_newline_total_credit_limit_of_open_trades_credit_card = Variables::inputs.PP076CC_newline_total_credit_limit_of_open_trades_3_months_ago_credit_card = Variables::inputs.PP077CC_newline_total_balance_of_open_trades_credit_card = Variables::inputs.PP082CC_newline_total_balance_of_open_trades_as_of_3_months_ago_credit_card = Variables::inputs.PP083CC_newline_total_balance_of_recent_satisfactory_open_trades_cellular = Variables::inputs.PP087CE_newline_total_balance_of_recent_satisfactory_open_trades_bank_micro_lenders = Variables::inputs.PP087NL_newline_total_balance_of_recent_satisfactory_open_trades_personal_loans = Variables::inputs.PP087PL_newline_number_of_trades_that_have_been_6_and_9_months_in_arrears_in_the_last_24_months_asset_finance = Variables::inputs.PP104VF_newline_number_of_cpa_trades = Variables::inputs.AT001_newline_number_of_cpa_write_offs_and_repossessions = Variables::inputs.AT039_newline_number_of_cpa_legal_actions_or_collections = Variables::inputs.AT040_newline_age_of_most_recent_cpa_write_off_or_repossession_in_months = Variables::inputs.AT162_newline_age_of_most_recent_cpa_legal_action_or_collection = Variables::inputs.AT163_newline_number_of_defaults = Variables::inputs.GE010_newline_number_of_defaults_in_the_last_12_mths = Variables::inputs.GE022_newline_number_of_judgements = Variables::inputs.GE030_newline_age_of_youngest_judgement = Variables::inputs.GE032_newline_number_of_notices_excluding_rehab = Variables::inputs.GE044_newline_age_of_recent_notice_administration_order = Variables::inputs.GE048_newline_age_of_recent_notice_intention_to_surrenderor_voluntary_sequestration = Variables::inputs.GE051_newline_age_of_recent_notice_provisional_sequestration = Variables::inputs.GE052_newline_age_of_recent_notice_provisional_sequestration_postponed = Variables::inputs.GE053_newline_age_of_recent_notice_final_sequestration = Variables::inputs.GE054_newline_age_of_youngest_default_admin_order = Variables::inputs.GE056_newline_number_of_micro_loan_trades = Variables::inputs.ML001_newline_number_of_micro_loan_write_offs_and_repossessions = Variables::inputs.ML039_newline_number_of_micro_loan_legal_actions_or_collections = Variables::inputs.ML040_newline_age_of_most_recent_micro_loan_write_off_or_repossession_in_months = Variables::inputs.ML162_newline_age_of_most_recent_micro_loan_legal_action_or_collection = Variables::inputs.ML163_newline__newline__newline_#### Test Variables_newline_#individual_age_all_industries = 49_newline_#deceased_indicator_all_industries = _sgl_quote_N_sgl_quote__newline_#deceased_indicator_all_industries.upcase!_newline_#number_of_enquiries_all_industries = 10_newline_#number_of_enquiries_finance_houses_micro_loan = 1_newline_#number_of_enquiries_finance_house_personal_loan = 0_newline_#number_of_enquiries_general_appliances = 0_newline_#number_of_enquiries_general_retail = 0_newline_#number_of_enquiries_homeware = 0_newline_#number_of_enquiries_jewelry = 0_newline_#number_of_enquiries_other = 1_newline_#number_of_enquiries_in_the_past_6_months_finance_houses_micro_loan = 0_newline_#number_of_enquiries_in_the_past_6_months_finance_house_personal_loan = -1_newline_#number_of_enquiries_in_the_past_12_months_general_appliances = -1_newline_#number_of_enquiries_in_the_past_12_months_general_retail = -1_newline_#number_of_enquiries_in_the_past_12_months_homeware = -1_newline_#number_of_enquiries_in_the_past_12_months_jewelry = -1_newline_#number_of_enquiries_in_the_past_12_months_other = 0_newline_#number_of_defaults_all_industries = 0_newline_#number_of_judgments_all_industries = 0_newline_#total_amount_of_judgments_all_industries = -1_newline_#number_of_trades_all_industries = 9_newline_#number_of_trades_collection_agency = 0_newline_#number_of_open_trades_all_industries = 8_newline_#number_of_trades_opened_in_past_6_months_all_industries = 1_newline_#number_of_open_trades_as_of_12_months_ago_all_industries = 6_newline_#number_of_trades_3_months_or_worse_in_arrears_mortgage_bonds = 0_newline_#number_of_trades_3_months_or_worse_in_arrears_asset_finance = 0_newline_#number_of_trades_4_months_or_worse_in_arrears_finance_houses_micro_loan = 0_newline_#number_of_trades_4_months_or_worse_in_arrears_finance_house_personal_loan = -2_newline_#number_of_trades_4_months_or_worse_in_arrears_bank_micro_lenders = 0_newline_#number_of_trades_4_months_or_worse_in_arrears_personal_loans = -2_newline_#number_of_write_offs_or_repossessions_ever_all_industries = 0_newline_#age_of_oldest_open_trade_cellular = -2_newline_#total_monthly_payment_of_open_trades_all_industries = 12897_newline_#total_monthly_payment_of_open_trades_as_of_12_months_ago_all_industries = 11322_newline_#total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card = -5_newline_#total_credit_limit_of_open_trades_credit_card = 55000_newline_#total_credit_limit_of_open_trades_3_months_ago_credit_card = 10000_newline_#total_balance_of_open_trades_credit_card = 39291_newline_#total_balance_of_open_trades_as_of_3_months_ago_credit_card = 10993_newline_#total_balance_of_recent_satisfactory_open_trades_cellular = -2_newline_#total_balance_of_recent_satisfactory_open_trades_bank_micro_lenders = -5_newline_#total_balance_of_recent_satisfactory_open_trades_personal_loans = -2_newline_#number_of_trades_that_have_been_6_and_9_months_in_arrears_in_the_last_24_months_asset_finance = 0_newline_#number_of_cpa_trades = 8_newline_#number_of_cpa_write_offs_and_repossessions = 0_newline_#number_of_cpa_legal_actions_or_collections = 0_newline_#age_of_most_recent_cpa_write_off_or_repossession_in_months = -3_newline_#age_of_most_recent_cpa_legal_action_or_collection = -3_newline_#number_of_defaults = 0_newline_#number_of_defaults_in_the_last_12_mths = -2_newline_#number_of_judgements = 0_newline_#age_of_youngest_judgement = -2_newline_#number_of_notices_excluding_rehab = 0_newline_#age_of_recent_notice_administration_order = -2_newline_#age_of_recent_notice_intention_to_surrenderor_voluntary_sequestration = -2_newline_#age_of_recent_notice_provisional_sequestration = -2_newline_#age_of_recent_notice_provisional_sequestration_postponed = -2_newline_#age_of_recent_notice_final_sequestration = -2_newline_#age_of_youngest_default_admin_order = -2_newline_#number_of_micro_loan_trades = 1_newline_#number_of_micro_loan_write_offs_and_repossessions = 0_newline_#number_of_micro_loan_legal_actions_or_collections = 0_newline_#age_of_most_recent_micro_loan_write_off_or_repossession_in_months = -3_newline_#age_of_most_recent_micro_loan_legal_action_or_collection = -3_newline__newline_ #***************************** sa home loans bcc customised scorecode march 2014 *****************************************_newline_ #**************  please note that this is for internal use for sa home loans only, do not distribute**********************_newline_    _newline_    #nb dispute and debt review filters should also be added to the list of decline filters but these are not available retrospectively (step 2.)_newline_    _newline_    #data in.test_newline_    #set _null__newline_    _newline_    #* 1. roll ups & recodes - creating additional variables from standard bccs and sbcs***_newline_    _newline_          #any default/judgment/write-off or collections trade or vaf trade 6 - 9 months in arrears_newline_          any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears = 0_newline_          #bcc f500 version_newline_          if (number_of_trades_collection_agency > 0 or number_of_write_offs_or_repossessions_ever_all_industries > 0 or number_of_defaults_all_industries > 0 or number_of_judgments_all_industries > 0 or number_of_cpa_write_offs_and_repossessions > 0 or number_of_micro_loan_write_offs_and_repossessions > 0 or number_of_micro_loan_legal_actions_or_collections > 0 or number_of_defaults > 0 or number_of_judgements > 0 or number_of_trades_that_have_been_6_and_9_months_in_arrears_in_the_last_24_months_asset_finance > 0)  _newline_            any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears = 1_newline_          end_newline_    _newline_          #number_of_enquiries_general_accounts number of enquiries general accounts_newline_          if number_of_enquiries_all_industries == 0  _newline_            number_of_enquiries_general_accounts = -1_newline_          else _newline_            if (number_of_enquiries_general_appliances < 0 and number_of_enquiries_general_retail < 0 and number_of_enquiries_homeware < 0 and number_of_enquiries_jewelry < 0 and number_of_enquiries_other < 0)_newline_              if (number_of_enquiries_general_appliances == -4 or number_of_enquiries_general_retail == -4 or number_of_enquiries_homeware == -4 or number_of_enquiries_jewelry == -4 or number_of_enquiries_other == -4)  _newline_                number_of_enquiries_general_accounts = -4_newline_              else _newline_                number_of_enquiries_general_accounts = [number_of_enquiries_general_appliances,number_of_enquiries_general_retail,number_of_enquiries_homeware,number_of_enquiries_jewelry,number_of_enquiries_other].min_newline_              end_newline_            else _newline_              number_of_enquiries_general_accounts = [number_of_enquiries_general_appliances,0].max + [number_of_enquiries_general_retail,0].max + [number_of_enquiries_homeware,0].max + [number_of_enquiries_jewelry,0].max + [number_of_enquiries_other,0].max_newline_            end_newline_          end_newline_    _newline_    _newline_          #number_of_enquiries_in_the_past_12_months_general_accounts = number of enquiries in the past 12 months general accounts_newline_          if number_of_enquiries_all_industries == 0  _newline_            number_of_enquiries_in_the_past_12_months_general_accounts = -1_newline_          else _newline_            if (number_of_enquiries_in_the_past_12_months_general_appliances < 0 and number_of_enquiries_in_the_past_12_months_general_retail < 0 and number_of_enquiries_in_the_past_12_months_homeware < 0 and number_of_enquiries_in_the_past_12_months_jewelry < 0 and number_of_enquiries_in_the_past_12_months_other < 0)  _newline_              if (number_of_enquiries_in_the_past_12_months_general_appliances == -4 or number_of_enquiries_in_the_past_12_months_general_retail == -4 or number_of_enquiries_in_the_past_12_months_homeware == -4 or number_of_enquiries_in_the_past_12_months_jewelry == -4 or number_of_enquiries_in_the_past_12_months_other == -4)  _newline_                number_of_enquiries_in_the_past_12_months_general_accounts = -4_newline_              else_newline_                number_of_enquiries_in_the_past_12_months_general_accounts = [number_of_enquiries_in_the_past_12_months_general_appliances,number_of_enquiries_in_the_past_12_months_general_retail,number_of_enquiries_in_the_past_12_months_homeware,number_of_enquiries_in_the_past_12_months_jewelry,number_of_enquiries_in_the_past_12_months_other].min_newline_              end_newline_            else _newline_              number_of_enquiries_in_the_past_12_months_general_accounts = [number_of_enquiries_in_the_past_12_months_general_appliances,0].max + [number_of_enquiries_in_the_past_12_months_general_retail,0].max + [number_of_enquiries_in_the_past_12_months_homeware,0].max + [number_of_enquiries_in_the_past_12_months_jewelry,0].max + [number_of_enquiries_in_the_past_12_months_other,0].max_newline_            end_newline_          end_newline_    _newline_          #new_variable_number_of_enquiries_in_the_past_12_months_general_accounts = new variable number of enquiries in the past 12 months general accounts_newline_          new_variable_number_of_enquiries_in_the_past_12_months_general_accounts = number_of_enquiries_in_the_past_12_months_general_accounts_newline_          if number_of_enquiries_general_accounts == 0  _newline_            new_variable_number_of_enquiries_in_the_past_12_months_general_accounts = -2_newline_          end_newline_    _newline_          if number_of_enquiries_all_industries == 0  _newline_            new_variable_number_of_enquiries_in_the_past_12_months_general_accounts = -1_newline_          end_newline_    _newline_    _newline_          #number_of_enquiries_finance_house_loans number of enquiries - finance house loans_newline_          if number_of_enquiries_all_industries == 0  _newline_            number_of_enquiries_finance_house_loans = -1_newline_          else _newline_            if number_of_enquiries_finance_houses_micro_loan < 0 and number_of_enquiries_finance_house_personal_loan < 0  _newline_              if (number_of_enquiries_finance_houses_micro_loan == -4 or number_of_enquiries_finance_house_personal_loan == -4)  _newline_                number_of_enquiries_finance_house_loans = -4_newline_              else _newline_                number_of_enquiries_finance_house_loans = [number_of_enquiries_finance_houses_micro_loan,number_of_enquiries_finance_house_personal_loan].min_newline_              end_newline_            else _newline_              number_of_enquiries_finance_house_loans = [number_of_enquiries_finance_houses_micro_loan,0].max + [number_of_enquiries_finance_house_personal_loan,0].max_newline_            end_newline_          end_newline_    _newline_          #number_of_enquiries_in_the_past_6_months_finance_house_loans = number of enquiries in the past 6 months - finance house loans_newline_          if number_of_enquiries_all_industries == 0  _newline_            number_of_enquiries_in_the_past_6_months_finance_house_loans = -1_newline_          else _newline_            if number_of_enquiries_in_the_past_6_months_finance_houses_micro_loan < 0 and number_of_enquiries_in_the_past_6_months_finance_house_personal_loan < 0  _newline_                if (number_of_enquiries_in_the_past_6_months_finance_houses_micro_loan == -4 or number_of_enquiries_in_the_past_6_months_finance_house_personal_loan == -4)  _newline_                  number_of_enquiries_in_the_past_6_months_finance_house_loans = -4_newline_                else _newline_                  number_of_enquiries_in_the_past_6_months_finance_house_loans = [number_of_enquiries_in_the_past_6_months_finance_houses_micro_loan,number_of_enquiries_in_the_past_6_months_finance_house_personal_loan].min_newline_                end_newline_            else _newline_              number_of_enquiries_in_the_past_6_months_finance_house_loans = [number_of_enquiries_in_the_past_6_months_finance_houses_micro_loan,0].max + [number_of_enquiries_in_the_past_6_months_finance_house_personal_loan,0].max_newline_            end _newline_          end_newline_    _newline_      _newline_          #new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans = new variable number of enquiries in the past 6 months - finance house loans_newline_          new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans = number_of_enquiries_in_the_past_6_months_finance_house_loans_newline_    _newline_          if number_of_enquiries_finance_house_loans == 0  _newline_            new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans = -2_newline_          end_newline_    _newline_          if number_of_enquiries_all_industries == 0  _newline_            new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans = -1_newline_          end_newline_    _newline_          #average_monthly_payment_12_months_ago_for_all = average monthly payment 12m ago, al_newline_          if number_of_trades_all_industries == 0  _newline_            average_monthly_payment_12_months_ago_for_all = -1_newline_          else_newline_             if total_monthly_payment_of_open_trades_as_of_12_months_ago_all_industries < 0 and number_of_open_trades_as_of_12_months_ago_all_industries <= 0  _newline_              average_monthly_payment_12_months_ago_for_all = [total_monthly_payment_of_open_trades_as_of_12_months_ago_all_industries,number_of_open_trades_as_of_12_months_ago_all_industries].min_newline_            else _newline_              if total_monthly_payment_of_open_trades_as_of_12_months_ago_all_industries < 0 or number_of_open_trades_as_of_12_months_ago_all_industries <= 0  _newline_                average_monthly_payment_12_months_ago_for_all = -4_newline_              else _newline_                average_monthly_payment_12_months_ago_for_all = (total_monthly_payment_of_open_trades_as_of_12_months_ago_all_industries.to_f / number_of_open_trades_as_of_12_months_ago_all_industries.to_f).round_newline_              end_newline_            end_newline_          end_newline_    _newline_          #average_monthly_payment_of_open_trades_al_all = average monthly payment of open trades, al_newline_          if number_of_trades_all_industries == 0  _newline_            average_monthly_payment_of_open_trades_al_all = -1_newline_          else _newline_            if total_monthly_payment_of_open_trades_all_industries < 0 and number_of_open_trades_all_industries <= 0  _newline_              average_monthly_payment_of_open_trades_al_all = [total_monthly_payment_of_open_trades_all_industries,number_of_open_trades_all_industries].min_newline_            else _newline_              if total_monthly_payment_of_open_trades_all_industries < 0 or number_of_open_trades_all_industries <= 0  _newline_                average_monthly_payment_of_open_trades_al_all = -4_newline_              else _newline_                average_monthly_payment_of_open_trades_al_all = (total_monthly_payment_of_open_trades_all_industries.to_f / number_of_open_trades_all_industries.to_f).round_newline_              end_newline_            end_newline_          end_newline_    _newline_    _newline_          #pecent_increase_in_average_payment_from_month_0_to_12_for_all = % increase in average payment from month 0-12, al_newline_          if number_of_trades_all_industries == 0 _newline_             pecent_increase_in_average_payment_from_month_0_to_12_for_all = -1_newline_          else_newline_             if average_monthly_payment_12_months_ago_for_all <= 0  _newline_                pecent_increase_in_average_payment_from_month_0_to_12_for_all = average_monthly_payment_12_months_ago_for_all_newline_             else _newline_                if (([0,average_monthly_payment_of_open_trades_al_all].max - average_monthly_payment_12_months_ago_for_all) < 0) _newline_                    pecent_increase_in_average_payment_from_month_0_to_12_for_all = -7_newline_                end_newline_                if (([0,average_monthly_payment_of_open_trades_al_all].max - average_monthly_payment_12_months_ago_for_all) >= 0) _newline_                    pecent_increase_in_average_payment_from_month_0_to_12_for_all = ((([0,average_monthly_payment_of_open_trades_al_all.to_f].max - average_monthly_payment_12_months_ago_for_all.to_f) / average_monthly_payment_12_months_ago_for_all.to_f)*100).round_newline_                end_newline_             end_newline_          end_newline__newline_          #puts _sgl_quote_average_monthly_payment_of_open_trades_al_all : _sgl_quote_ + average_monthly_payment_of_open_trades_al_all.to_s + _sgl_quote_ | average_monthly_payment_12_months_ago_for_all : _sgl_quote_ + average_monthly_payment_12_months_ago_for_all.to_s + _sgl_quote_ | number_of_trades_all_industries : _sgl_quote_ + number_of_trades_all_industries.to_s _newline_    _newline_          #total_balance_of_recent_satisfactory_open_trades = total balance of recent satisfactory open trades_newline_          if number_of_trades_all_industries == 0 _newline_             total_balance_of_recent_satisfactory_open_trades = -1_newline_          else _newline_            if total_balance_of_recent_satisfactory_open_trades_bank_micro_lenders < 0 and total_balance_of_recent_satisfactory_open_trades_personal_loans < 0  _newline_              if (total_balance_of_recent_satisfactory_open_trades_bank_micro_lenders == -4 or total_balance_of_recent_satisfactory_open_trades_personal_loans == -4)  _newline_                total_balance_of_recent_satisfactory_open_trades = -4_newline_              else _newline_                total_balance_of_recent_satisfactory_open_trades = [total_balance_of_recent_satisfactory_open_trades_bank_micro_lenders,total_balance_of_recent_satisfactory_open_trades_personal_loans].min_newline_              end_newline_            else _newline_              total_balance_of_recent_satisfactory_open_trades = [total_balance_of_recent_satisfactory_open_trades_bank_micro_lenders,0].max + [total_balance_of_recent_satisfactory_open_trades_personal_loans,0].max _newline_            end_newline_          end_newline_    _newline_          #utilisation_of_open_trades_3_months_ago_for_cc = utilisation of open trades, 3m ago, cc_newline_          if number_of_trades_all_industries == 0  _newline_            utilisation_of_open_trades_3_months_ago_for_cc = -1_newline_          else_newline_             if total_credit_limit_of_open_trades_3_months_ago_credit_card < 0 and total_balance_of_open_trades_as_of_3_months_ago_credit_card < 0  _newline_              utilisation_of_open_trades_3_months_ago_for_cc = [total_credit_limit_of_open_trades_3_months_ago_credit_card,total_balance_of_open_trades_as_of_3_months_ago_credit_card].min_newline_             else_newline_              if total_credit_limit_of_open_trades_3_months_ago_credit_card <= 0 or total_balance_of_open_trades_as_of_3_months_ago_credit_card < 0  _newline_                utilisation_of_open_trades_3_months_ago_for_cc = -4_newline_              else _newline_                utilisation_of_open_trades_3_months_ago_for_cc = ((total_balance_of_open_trades_as_of_3_months_ago_credit_card.to_f / total_credit_limit_of_open_trades_3_months_ago_credit_card.to_f)*100).round_newline_              end_newline_             end_newline_          end_newline_    _newline_          #utilisation_of_open_trades_for_cc = utilisation of open trades, cc_newline_          if number_of_trades_all_industries == 0  _newline_            utilisation_of_open_trades_for_cc = -1_newline_          else_newline_            if total_credit_limit_of_open_trades_credit_card < 0 and total_balance_of_open_trades_credit_card < 0 _newline_              utilisation_of_open_trades_for_cc = [total_credit_limit_of_open_trades_credit_card,total_balance_of_open_trades_credit_card].min_newline_            else _newline_              if total_credit_limit_of_open_trades_credit_card <= 0 or total_balance_of_open_trades_credit_card < 0  _newline_                utilisation_of_open_trades_for_cc = -4_newline_              else _newline_                utilisation_of_open_trades_for_cc = ((total_balance_of_open_trades_credit_card.to_f / total_credit_limit_of_open_trades_credit_card.to_f)*100).round_newline_              end_newline_            end_newline_          end_newline_          #puts _sgl_quote_utilisation_of_open_trades_for_cc : _sgl_quote_ + utilisation_of_open_trades_for_cc.to_s + _sgl_quote_ | number_of_trades_all_industries : _sgl_quote_ + number_of_trades_all_industries.to_s + _sgl_quote_ | total_credit_limit_of_open_trades_credit_card : _sgl_quote_ + total_credit_limit_of_open_trades_credit_card.to_s + _sgl_quote_ | total_balance_of_open_trades_credit_card : _sgl_quote_ + total_balance_of_open_trades_credit_card.to_s_newline_          _newline_          #average_utilisation_of_open_trades_over_last_3_months_for_cc = average utilisation of open trades over last 3 months, cc _newline_          numerator_085cc = 0_newline_          _newline_          if utilisation_of_open_trades_3_months_ago_for_cc >= 0  _newline_              numerator_085cc = numerator_085cc +1_newline_          end_newline_          _newline_          if utilisation_of_open_trades_for_cc >= 0  _newline_              numerator_085cc = numerator_085cc +1_newline_          end_newline_          _newline_          if number_of_trades_all_industries == 0  _newline_            average_utilisation_of_open_trades_over_last_3_months_for_cc = -1_newline_          else_newline_            if utilisation_of_open_trades_for_cc < 0  _newline_              if utilisation_of_open_trades_for_cc != -4  _newline_                average_utilisation_of_open_trades_over_last_3_months_for_cc = utilisation_of_open_trades_for_cc_newline_              end_newline_              if utilisation_of_open_trades_for_cc == -4  _newline_              if utilisation_of_open_trades_3_months_ago_for_cc == -5  _newline_                average_utilisation_of_open_trades_over_last_3_months_for_cc = -5_newline_              else _newline_                if utilisation_of_open_trades_3_months_ago_for_cc == -4  _newline_                average_utilisation_of_open_trades_over_last_3_months_for_cc = -4_newline_                else_newline_                if utilisation_of_open_trades_3_months_ago_for_cc >= 0 _newline_                   average_utilisation_of_open_trades_over_last_3_months_for_cc = utilisation_of_open_trades_3_months_ago_for_cc_newline_                end_newline_                end_newline_              end_newline_              end_newline_            else _newline_              if numerator_085cc == 0 _newline_                numerator_085cc = 1_newline_              end_newline_              average_utilisation_of_open_trades_over_last_3_months_for_cc = (([0.0,utilisation_of_open_trades_3_months_ago_for_cc.to_f].max + [0.0,utilisation_of_open_trades_for_cc.to_f].max) / numerator_085cc.to_f).round_newline_            end_newline_          end         _newline_          _newline_          #drop numerator_085cc_newline_          numerator_085cc = nil_newline__newline_   _newline_          #number_of_trades_4_plus_months_in_arrears_for_cpa_and_micro_loans_and_personal_loans = number of trades 4+ cpa micro loans and personal loans_newline_          if number_of_trades_all_industries == 0  _newline_            number_of_trades_4_plus_months_in_arrears_for_cpa_and_micro_loans_and_personal_loans = -1_newline_          else_newline_             if number_of_trades_4_months_or_worse_in_arrears_bank_micro_lenders < 0 and number_of_trades_4_months_or_worse_in_arrears_personal_loans < 0  _newline_                if (number_of_trades_4_months_or_worse_in_arrears_bank_micro_lenders == -4 or number_of_trades_4_months_or_worse_in_arrears_personal_loans == -4)  _newline_                  number_of_trades_4_plus_months_in_arrears_for_cpa_and_micro_loans_and_personal_loans = -4_newline_                else _newline_                  number_of_trades_4_plus_months_in_arrears_for_cpa_and_micro_loans_and_personal_loans = [number_of_trades_4_months_or_worse_in_arrears_bank_micro_lenders,number_of_trades_4_months_or_worse_in_arrears_personal_loans].min_newline_                end_newline_             else _newline_               number_of_trades_4_plus_months_in_arrears_for_cpa_and_micro_loans_and_personal_loans = [number_of_trades_4_months_or_worse_in_arrears_bank_micro_lenders,0].max + [number_of_trades_4_months_or_worse_in_arrears_personal_loans,0].max_newline_             end _newline_          end_newline_    _newline_          #number_of_trades_4_plus_months_in_arrears_for_finance_house_loans_and_non_bank_micro_loans = number of trades 4+ finance house loans and non bank micro loans_newline_          if number_of_trades_all_industries == 0  _newline_            number_of_trades_4_plus_months_in_arrears_for_finance_house_loans_and_non_bank_micro_loans = -1_newline_          else_newline_            if number_of_trades_4_months_or_worse_in_arrears_finance_houses_micro_loan < 0 and number_of_trades_4_months_or_worse_in_arrears_finance_house_personal_loan < 0  _newline_              if (number_of_trades_4_months_or_worse_in_arrears_finance_houses_micro_loan == -4 or number_of_trades_4_months_or_worse_in_arrears_finance_house_personal_loan == -4)_newline_                 number_of_trades_4_plus_months_in_arrears_for_finance_house_loans_and_non_bank_micro_loans = -4_newline_              else _newline_                number_of_trades_4_plus_months_in_arrears_for_finance_house_loans_and_non_bank_micro_loans = [number_of_trades_4_months_or_worse_in_arrears_finance_houses_micro_loan,number_of_trades_4_months_or_worse_in_arrears_finance_house_personal_loan].min_newline_              end_newline_            else _newline_              number_of_trades_4_plus_months_in_arrears_for_finance_house_loans_and_non_bank_micro_loans = [number_of_trades_4_months_or_worse_in_arrears_finance_houses_micro_loan,0].max + [number_of_trades_4_months_or_worse_in_arrears_finance_house_personal_loan,0].max_newline_            end_newline_          end_newline_    _newline_    _newline_    _newline_          # number_of_trades_plus_months_in_arrears_for_combine_personal_loans_and_nlr_and_cpa_micro_loans = number of trades 4+ in arrears - combine personal loans and nlr and cpa micro loans_newline_          if number_of_trades_4_plus_months_in_arrears_for_cpa_and_micro_loans_and_personal_loans >= 0 and number_of_trades_4_plus_months_in_arrears_for_finance_house_loans_and_non_bank_micro_loans == -2 _newline_             number_of_trades_plus_months_in_arrears_for_combine_personal_loans_and_nlr_and_cpa_micro_loans = number_of_trades_4_plus_months_in_arrears_for_cpa_and_micro_loans_and_personal_loans_newline_          end_newline_          if number_of_trades_4_plus_months_in_arrears_for_cpa_and_micro_loans_and_personal_loans == -2 and number_of_trades_4_plus_months_in_arrears_for_finance_house_loans_and_non_bank_micro_loans >= 0 _newline_             number_of_trades_plus_months_in_arrears_for_combine_personal_loans_and_nlr_and_cpa_micro_loans = number_of_trades_4_plus_months_in_arrears_for_finance_house_loans_and_non_bank_micro_loans_newline_          end_newline_          if number_of_trades_4_plus_months_in_arrears_for_cpa_and_micro_loans_and_personal_loans == -2 and number_of_trades_4_plus_months_in_arrears_for_finance_house_loans_and_non_bank_micro_loans == -2 _newline_             number_of_trades_plus_months_in_arrears_for_combine_personal_loans_and_nlr_and_cpa_micro_loans = -2_newline_          end_newline_          if number_of_trades_4_plus_months_in_arrears_for_cpa_and_micro_loans_and_personal_loans ==-1 and number_of_trades_4_plus_months_in_arrears_for_finance_house_loans_and_non_bank_micro_loans == -1 _newline_             number_of_trades_plus_months_in_arrears_for_combine_personal_loans_and_nlr_and_cpa_micro_loans = -1_newline_          end_newline_          if number_of_trades_4_plus_months_in_arrears_for_cpa_and_micro_loans_and_personal_loans >= 0 and number_of_trades_4_plus_months_in_arrears_for_finance_house_loans_and_non_bank_micro_loans >= 0  _newline_             number_of_trades_plus_months_in_arrears_for_combine_personal_loans_and_nlr_and_cpa_micro_loans = number_of_trades_4_plus_months_in_arrears_for_cpa_and_micro_loans_and_personal_loans + number_of_trades_4_plus_months_in_arrears_for_finance_house_loans_and_non_bank_micro_loans_newline_          end_newline_    _newline_    _newline_    _newline_    #***** 2. apply filter code *******_newline_       #nb dispute and debt review filters should also be added to the list of decline filters but these are not available retrospectively_newline_           filter1=0_newline_           filter2=0_newline_           filter3a=0_newline_           filter3b=0_newline_           filter3c=0_newline_           filter4=0_newline_           filter5=0_newline_           filter6=0_newline_           filter7a=0_newline_           filter7b=0_newline_           filter7c=0_newline_           filter8=0_newline_           filter9=0_newline_           filter10=0_newline_           filter11=0_newline_           _newline_           #no match_newline_           if number_of_cpa_trades == nil _newline_              filter1 = 1_newline_           end_newline_     _newline_           #no trades_newline_           if number_of_cpa_trades == 0 and number_of_micro_loan_trades == 0 _newline_              filter2 = 1_newline_           end_newline_    _newline_           #one more trade 4+ in the pl, nl, fc or fl industry_newline_           if number_of_trades_plus_months_in_arrears_for_combine_personal_loans_and_nlr_and_cpa_micro_loans > 0 _newline_              filter3a = 1_newline_           end_newline_    _newline_           #one more trade 3+ in the mb industry_newline_           if number_of_trades_3_months_or_worse_in_arrears_mortgage_bonds > 0 _newline_              filter3b = 1_newline_           end_newline_    _newline_           #one more trade 3+ in the vf industry_newline_           if number_of_trades_3_months_or_worse_in_arrears_asset_finance > 0 _newline_              filter3c = 1_newline_           end_newline_    _newline_           #one or more write off in the last 12 months_newline_           if (number_of_cpa_write_offs_and_repossessions > 0 and (age_of_most_recent_cpa_write_off_or_repossession_in_months >= 0 and age_of_most_recent_cpa_write_off_or_repossession_in_months <= 12)) or (number_of_micro_loan_write_offs_and_repossessions > 0 and (age_of_most_recent_micro_loan_write_off_or_repossession_in_months >= 0 and age_of_most_recent_micro_loan_write_off_or_repossession_in_months <= 12))_newline_              filter4 = 1_newline_           end_newline_    _newline_           #one or more legal action/collection in the last 12 months_newline_           if (number_of_cpa_legal_actions_or_collections > 0  and (age_of_most_recent_cpa_legal_action_or_collection >=0 and age_of_most_recent_cpa_legal_action_or_collection <= 12)) or (number_of_micro_loan_legal_actions_or_collections > 0 and (age_of_most_recent_micro_loan_legal_action_or_collection >= 0 and age_of_most_recent_micro_loan_legal_action_or_collection <= 12))  _newline_              filter5 = 1_newline_           end_newline_    _newline_           #two or more defaults ever, or 1 or more default in the last 12 months_newline_           if number_of_defaults > 1 or (number_of_defaults_in_the_last_12_mths > 0) _newline_              filter6 = 1_newline_           end_newline_    _newline_           #one or more judgement_newline_           if number_of_judgements > 0 _newline_              filter7a = 1_newline_           end_newline_    _newline_           #amount of judgment > r5000_newline_           if number_of_judgements > 0 and total_amount_of_judgments_all_industries > 5000 _newline_              filter7b = 1_newline_           end_newline_    _newline_           #age of youngest judgment < 36 months_newline_           if number_of_judgements > 0 and age_of_youngest_judgement <= 36 _newline_              filter7c = 1_newline_           end_newline_    _newline_           #any notice or admin order ever_newline_           if (number_of_notices_excluding_rehab > 0) or (age_of_recent_notice_administration_order >= 0 and age_of_recent_notice_administration_order <= 120) or (age_of_youngest_default_admin_order >= 0 and age_of_youngest_default_admin_order <= 120) _newline_              filter8 = 1_newline_           end_newline_    _newline_           #   sequestration_newline_           if (age_of_recent_notice_intention_to_surrenderor_voluntary_sequestration > 0) or (age_of_recent_notice_provisional_sequestration > 0) or (age_of_recent_notice_provisional_sequestration_postponed > 0) or (age_of_recent_notice_final_sequestration > 0) _newline_              filter9 = 1_newline_           end_newline_    _newline_           #underage_newline_           if (individual_age_all_industries >= 0 and individual_age_all_industries <= 18) _newline_              filter10 = 1_newline_           end_newline_    _newline_           #deceased_newline_           if deceased_indicator_all_industries == _sgl_quote_Y_sgl_quote__newline_              filter11 = 1_newline_           end_newline_    _newline_  _newline_        #flag kick_out policy filters_newline_    _newline_             #format_newline_             #to_be_scored $3. _newline_             _newline_             to_be_scored = _sgl_quote_yes_sgl_quote__newline_             if filter1 == 1 or filter2 == 1 or  filter8 == 1 or filter9 == 1 or filter10 == 1 or filter11 == 1_newline_                to_be_scored = _sgl_quote_no_sgl_quote__newline_             end_newline__newline_      #************ 3. score consumers that pass filters ***********************_newline_    _newline_    if to_be_scored == _sgl_quote_yes_sgl_quote_ _newline_    _newline_        #reset values_newline_        intercept = 4.2101374892_newline_        age_of_oldest_open_trade_cellular_score = 0.0_newline_        new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_score = 0.0_newline_        new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_score = 0.0_newline_        pecent_increase_in_average_payment_from_month_0_to_12_for_all_score = 0.0_newline_        average_utilisation_of_open_trades_over_last_3_months_for_cc_score = 0.0_newline_        number_of_trades_opened_in_past_6_months_all_industries_score = 0.0_newline_        total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_score = 0.0_newline_        total_balance_of_recent_satisfactory_open_trades_cellular_score = 0.0_newline_        total_balance_of_recent_satisfactory_open_trades_score = 0.0_newline_        any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears_score = 0.0_newline_    _newline_    _newline_    _newline_        #assign raw scores (woe*estimate)_newline_        if age_of_oldest_open_trade_cellular==-5 _newline_          age_of_oldest_open_trade_cellular_score = 0 _newline_        end_newline_        if age_of_oldest_open_trade_cellular==-2 _newline_          age_of_oldest_open_trade_cellular_score = -0.1217460096_newline_        end _newline_        if age_of_oldest_open_trade_cellular==-1 _newline_          age_of_oldest_open_trade_cellular_score = 0 _newline_        end_newline_        if (age_of_oldest_open_trade_cellular >= 0 and age_of_oldest_open_trade_cellular <=46) _newline_          age_of_oldest_open_trade_cellular_score = -0.3747141351_newline_        end _newline_        if (age_of_oldest_open_trade_cellular > 46 and age_of_oldest_open_trade_cellular <=101)_newline_          age_of_oldest_open_trade_cellular_score = 0.3706509064_newline_        end _newline_        if age_of_oldest_open_trade_cellular>101 _newline_          age_of_oldest_open_trade_cellular_score = 0.5913872376_newline_        end _newline_    _newline_    _newline_        #dummy variable_newline_        if new_variable_number_of_enquiries_in_the_past_12_months_general_accounts==-2 _newline_          new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_score = 0_newline_        end _newline_        if new_variable_number_of_enquiries_in_the_past_12_months_general_accounts==-1 _newline_          new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_score = 0 _newline_        end_newline_        if (new_variable_number_of_enquiries_in_the_past_12_months_general_accounts >= 0 and new_variable_number_of_enquiries_in_the_past_12_months_general_accounts <= 1) _newline_          new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_score = 0 _newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_12_months_general_accounts==2 _newline_          new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_score = 0 _newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_12_months_general_accounts>2 _newline_          new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_score = -0.898053516_newline_        end _newline_    _newline_        if new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans==-2 _newline_          new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_score = 0.2297556336 _newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans==-1 _newline_          new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_score = 0.5216153307 _newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans==0 _newline_          new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_score = -0.1769988304 _newline_        end_newline_        if (new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans > 0 and new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans <=2)_newline_          new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_score = -0.6788237592 _newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans>2 _newline_          new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_score = -1.0164888132_newline_        end _newline_    _newline_        if number_of_trades_opened_in_past_6_months_all_industries==-1 _newline_          number_of_trades_opened_in_past_6_months_all_industries_score = 0_newline_        end _newline_        if number_of_trades_opened_in_past_6_months_all_industries==0 _newline_          number_of_trades_opened_in_past_6_months_all_industries_score = 0.2937868984 _newline_        end_newline_        if (number_of_trades_opened_in_past_6_months_all_industries > 0 and number_of_trades_opened_in_past_6_months_all_industries <=2)_newline_          number_of_trades_opened_in_past_6_months_all_industries_score = -0.1046386091 _newline_        end_newline_        if number_of_trades_opened_in_past_6_months_all_industries==3 _newline_          number_of_trades_opened_in_past_6_months_all_industries_score = -0.4438106809 _newline_        end_newline_        if number_of_trades_opened_in_past_6_months_all_industries>3 _newline_          number_of_trades_opened_in_past_6_months_all_industries_score = -0.7192307916 _newline_        end_newline_    _newline_        if total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card==-5 _newline_          total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_score = 0 _newline_        end_newline_        if total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card==-2 _newline_          total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_score = 0 _newline_        end_newline_        if total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card==-1 _newline_          total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_score = 0 _newline_        end_newline_        if (total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card >= 0 and total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card <= 740)_newline_          total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_score = 0.5077511835 _newline_        end_newline_        if total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card>740 _newline_          total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_score = -0.0352423682 _newline_        end_newline_    _newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all==-7 _newline_          pecent_increase_in_average_payment_from_month_0_to_12_for_all_score = 0.1282519254 _newline_        end_newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all==-5 _newline_          pecent_increase_in_average_payment_from_month_0_to_12_for_all_score = 0_newline_        end _newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all==-4 _newline_          pecent_increase_in_average_payment_from_month_0_to_12_for_all_score = 0_newline_        end _newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all==-1 _newline_          pecent_increase_in_average_payment_from_month_0_to_12_for_all_score = -0.2559610671_newline_        end _newline_        if (pecent_increase_in_average_payment_from_month_0_to_12_for_all >= 0 and pecent_increase_in_average_payment_from_month_0_to_12_for_all <= 34)_newline_          pecent_increase_in_average_payment_from_month_0_to_12_for_all_score = 0.2884025269_newline_        end _newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all>34 _newline_          pecent_increase_in_average_payment_from_month_0_to_12_for_all_score = -0.3520131232_newline_        end _newline_    _newline_        if total_balance_of_recent_satisfactory_open_trades==-6 _newline_           total_balance_of_recent_satisfactory_open_trades_score = -0.3504508302 _newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades==-5 _newline_           total_balance_of_recent_satisfactory_open_trades_score = 0.0934245013_newline_        end _newline_        if total_balance_of_recent_satisfactory_open_trades==-2 _newline_           total_balance_of_recent_satisfactory_open_trades_score = 0.2031864068_newline_        end _newline_        if total_balance_of_recent_satisfactory_open_trades==-1 _newline_           total_balance_of_recent_satisfactory_open_trades_score = 0_newline_        end _newline_        if (total_balance_of_recent_satisfactory_open_trades >= 0 and total_balance_of_recent_satisfactory_open_trades <= 13066)_newline_           total_balance_of_recent_satisfactory_open_trades_score = 0.131716734_newline_        end _newline_        if (total_balance_of_recent_satisfactory_open_trades > 13066 and total_balance_of_recent_satisfactory_open_trades <= 43181)_newline_           total_balance_of_recent_satisfactory_open_trades_score = -0.204498049_newline_        end _newline_        if total_balance_of_recent_satisfactory_open_trades>43181 _newline_           total_balance_of_recent_satisfactory_open_trades_score = -0.4431679766_newline_        end _newline_    _newline_        if total_balance_of_recent_satisfactory_open_trades_cellular==-6 _newline_           total_balance_of_recent_satisfactory_open_trades_cellular_score = -0.4534508358 _newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades_cellular==-5 _newline_           total_balance_of_recent_satisfactory_open_trades_cellular_score = 0 _newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades_cellular==-2 _newline_           total_balance_of_recent_satisfactory_open_trades_cellular_score = 0 _newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades_cellular==-1 _newline_           total_balance_of_recent_satisfactory_open_trades_cellular_score = 0 _newline_        end_newline_        if (total_balance_of_recent_satisfactory_open_trades_cellular >= 0 and total_balance_of_recent_satisfactory_open_trades_cellular <= 567)_newline_           total_balance_of_recent_satisfactory_open_trades_cellular_score = 0.2306305793 _newline_        end_newline_        if (total_balance_of_recent_satisfactory_open_trades_cellular > 567 and total_balance_of_recent_satisfactory_open_trades_cellular <= 1268)_newline_           total_balance_of_recent_satisfactory_open_trades_cellular_score = 0.130229771 _newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades_cellular>1268 _newline_           total_balance_of_recent_satisfactory_open_trades_cellular_score = -0.3459064648 _newline_        end_newline_    _newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc==-5 _newline_           average_utilisation_of_open_trades_over_last_3_months_for_cc_score = 0_newline_        end_newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc==-4 _newline_           average_utilisation_of_open_trades_over_last_3_months_for_cc_score = 0 _newline_        end_newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc==-2 _newline_           average_utilisation_of_open_trades_over_last_3_months_for_cc_score = -0.1548811106_newline_        end _newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc==-1 _newline_           average_utilisation_of_open_trades_over_last_3_months_for_cc_score = 0_newline_        end _newline_        if (average_utilisation_of_open_trades_over_last_3_months_for_cc >= 0 and average_utilisation_of_open_trades_over_last_3_months_for_cc <= 64)_newline_           average_utilisation_of_open_trades_over_last_3_months_for_cc_score = 0.385020854_newline_        end _newline_        if (average_utilisation_of_open_trades_over_last_3_months_for_cc > 64 and average_utilisation_of_open_trades_over_last_3_months_for_cc <= 97)_newline_           average_utilisation_of_open_trades_over_last_3_months_for_cc_score = -0.0477069265 _newline_        end_newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc>97 _newline_           average_utilisation_of_open_trades_over_last_3_months_for_cc_score = -0.3836416895 _newline_        end_newline_         _newline_        if any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears==0 _newline_           any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears_score = 0.0294656645_newline_        end _newline_        if any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears>0 _newline_           any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears_score = -0.3786477339_newline_        end _newline_        rawscore = 0.0_newline_        rawscore=(intercept+age_of_oldest_open_trade_cellular_score+new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_score+new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_score+pecent_increase_in_average_payment_from_month_0_to_12_for_all_score+average_utilisation_of_open_trades_over_last_3_months_for_cc_score+number_of_trades_opened_in_past_6_months_all_industries_score+total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_score+total_balance_of_recent_satisfactory_open_trades_cellular_score+total_balance_of_recent_satisfactory_open_trades_score+any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears_score)_newline_    _newline_  _newline_      #***** 4.  scale score ***************_newline_    _newline_      #%let score      = 650    #score at certain odds_newline_      score = 650_newline_      #%let oddsatscore    = 15     #odds at required score_newline_      oddsatscore = 15_newline_      #%let pdo      = 15     #pdo - points to double odds_newline_      pdo = 15_newline_    _newline_    _newline_      #%let factor = &pdo. / log(2)         #no input required_newline_      factor = pdo / Math.log(2)_newline_      #%let offset = &score. - &factor. * log(&oddsatscore.)#no input required_newline_      offset = score - factor * Math.log(oddsatscore)_newline_        _newline_      if to_be_scored == _sgl_quote_yes_sgl_quote_ _newline_        scaled_score_bcc = (offset.to_f + (rawscore.to_f * factor.to_f)).round_newline_      end_newline_    _newline_    _newline_      #***** 5.  assign scorecard bands ***************_newline_    _newline_      # format  bcc_band_scaled_ri = nil_newline_      if scaled_score_bcc <= 669 _newline_         bcc_band_scaled_ri = _sgl_quote_e 0 - 669_sgl_quote__newline_      else _newline_         if scaled_score_bcc <= 684 _newline_            bcc_band_scaled_ri = _sgl_quote_d 670 - 684_sgl_quote__newline_         else _newline_            if scaled_score_bcc <= 696 _newline_               bcc_band_scaled_ri = _sgl_quote_c 685 - 696_sgl_quote__newline_            else _newline_               if scaled_score_bcc <= 709 _newline_                  bcc_band_scaled_ri = _sgl_quote_b 697 - 709_sgl_quote__newline_               else _newline_                  if scaled_score_bcc <= 10000 _newline_                     bcc_band_scaled_ri = _sgl_quote_a 710 - 1000_sgl_quote__newline_                  end_newline_               end_newline_            end_newline_         end_newline_      end_newline_    _newline_    _newline_      #**** 6. apply formatting code **************_newline_      #  format _newline_        new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_f=nil_newline_        new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_f=nil_newline_        pecent_increase_in_average_payment_from_month_0_to_12_for_all_f=nil_newline_        average_utilisation_of_open_trades_over_last_3_months_for_cc_f=nil_newline_        number_of_trades_opened_in_past_6_months_all_industries_f=nil_newline_        age_of_oldest_open_trade_cellular_f=nil_newline_        total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_f=nil_newline_        total_balance_of_recent_satisfactory_open_trades_cellular_f=nil_newline_        total_balance_of_recent_satisfactory_open_trades_f=nil_newline_        any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears_f=nil_newline_    _newline_        if age_of_oldest_open_trade_cellular==-5    _newline_             age_of_oldest_open_trade_cellular_f =    _sgl_quote_a -5 _sgl_quote_   _newline_        end_newline_        if age_of_oldest_open_trade_cellular==-2    _newline_             age_of_oldest_open_trade_cellular_f =    _sgl_quote_b -2 _sgl_quote_   _newline_        end_newline_        if age_of_oldest_open_trade_cellular==-1    _newline_             age_of_oldest_open_trade_cellular_f =    _sgl_quote_c -1 _sgl_quote_   _newline_        end_newline_        if (age_of_oldest_open_trade_cellular >= 0 and age_of_oldest_open_trade_cellular <= 46)    _newline_             age_of_oldest_open_trade_cellular_f =    _sgl_quote_d 0 - 46 _sgl_quote_   _newline_        end_newline_        if (age_of_oldest_open_trade_cellular > 46 and age_of_oldest_open_trade_cellular <= 101)   _newline_             age_of_oldest_open_trade_cellular_f =    _sgl_quote_e 47 - 101 _sgl_quote_   _newline_        end_newline_        if age_of_oldest_open_trade_cellular>101   _newline_             age_of_oldest_open_trade_cellular_f =    _sgl_quote_f 102 + _sgl_quote_    _newline_        end_newline_                  _newline_        if new_variable_number_of_enquiries_in_the_past_12_months_general_accounts==-2    _newline_             new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_f =    _sgl_quote_a -2 _sgl_quote__newline_        end   _newline_        if new_variable_number_of_enquiries_in_the_past_12_months_general_accounts==-1    _newline_             new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_f =    _sgl_quote_b -1 _sgl_quote_   _newline_        end_newline_        if (new_variable_number_of_enquiries_in_the_past_12_months_general_accounts >= 0 and new_variable_number_of_enquiries_in_the_past_12_months_general_accounts <=1) _newline_             new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_f =    _sgl_quote_c 0 - 1 _sgl_quote_    _newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_12_months_general_accounts==2   _newline_             new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_f =    _sgl_quote_d 2 _sgl_quote_    _newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_12_months_general_accounts>2   _newline_             new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_f =    _sgl_quote_e 3 + _sgl_quote_    _newline_        end_newline_                  _newline_        if new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans==-2    _newline_             new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_f =    _sgl_quote_a -2 _sgl_quote_   _newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans==-1    _newline_             new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_f =    _sgl_quote_b -1 _sgl_quote_   _newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans==0   _newline_             new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_f =    _sgl_quote_c 0 _sgl_quote_    _newline_        end_newline_        if (new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans > 0 and new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans <=2)    _newline_             new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_f =    _sgl_quote_d 1 - 2 _sgl_quote_    _newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans>2   _newline_             new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_f =    _sgl_quote_e 3 + _sgl_quote_    _newline_        end_newline_                  _newline_        if number_of_trades_opened_in_past_6_months_all_industries==-1    _newline_             number_of_trades_opened_in_past_6_months_all_industries_f =    _sgl_quote_a -1 _sgl_quote_   _newline_        end_newline_        if number_of_trades_opened_in_past_6_months_all_industries==0   _newline_             number_of_trades_opened_in_past_6_months_all_industries_f =    _sgl_quote_b 0 _sgl_quote_    _newline_        end_newline_        if (number_of_trades_opened_in_past_6_months_all_industries > 0 and number_of_trades_opened_in_past_6_months_all_industries <=2)  _newline_             number_of_trades_opened_in_past_6_months_all_industries_f =    _sgl_quote_c 1 - 2 _sgl_quote_    _newline_        end_newline_        if number_of_trades_opened_in_past_6_months_all_industries==3   _newline_             number_of_trades_opened_in_past_6_months_all_industries_f =    _sgl_quote_d 3 _sgl_quote_    _newline_        end_newline_        if number_of_trades_opened_in_past_6_months_all_industries>3   _newline_             number_of_trades_opened_in_past_6_months_all_industries_f =    _sgl_quote_e 4 + _sgl_quote_    _newline_        end_newline_                  _newline_        if total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card==-5    _newline_             total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_f =    _sgl_quote_a -5 _sgl_quote_   _newline_        end_newline_        if total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card==-2    _newline_             total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_f =    _sgl_quote_b -2 _sgl_quote_   _newline_        end_newline_        if total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card==-1    _newline_             total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_f =    _sgl_quote_c -1 _sgl_quote_   _newline_        end_newline_        if (total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card > 0 and total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card <= 740)   _newline_             total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_f =    _sgl_quote_d 0 - 740 _sgl_quote_    _newline_        end_newline_        if total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card>740   _newline_             total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_f =    _sgl_quote_e 741 + _sgl_quote_    _newline_        end_newline_                  _newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all==-7    _newline_             pecent_increase_in_average_payment_from_month_0_to_12_for_all_f =    _sgl_quote_a -7 _sgl_quote__newline_        end   _newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all==-5    _newline_             pecent_increase_in_average_payment_from_month_0_to_12_for_all_f =    _sgl_quote_b -5 _sgl_quote_   _newline_        end_newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all==-4    _newline_             pecent_increase_in_average_payment_from_month_0_to_12_for_all_f =    _sgl_quote_c -4 _sgl_quote_   _newline_        end_newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all==-1    _newline_             pecent_increase_in_average_payment_from_month_0_to_12_for_all_f =    _sgl_quote_d -1 _sgl_quote_   _newline_        end_newline_        if (pecent_increase_in_average_payment_from_month_0_to_12_for_all >= 0 and pecent_increase_in_average_payment_from_month_0_to_12_for_all <= 34)    _newline_             pecent_increase_in_average_payment_from_month_0_to_12_for_all_f =    _sgl_quote_e 0 - 34 _sgl_quote_   _newline_        end_newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all>34    _newline_             pecent_increase_in_average_payment_from_month_0_to_12_for_all_f =    _sgl_quote_f 35 + _sgl_quote_   _newline_        end_newline_                  _newline_        if total_balance_of_recent_satisfactory_open_trades==-6    _newline_             total_balance_of_recent_satisfactory_open_trades_f =    _sgl_quote_a -6 _sgl_quote_   _newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades==-5    _newline_             total_balance_of_recent_satisfactory_open_trades_f =    _sgl_quote_b -5 _sgl_quote_   _newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades==-2    _newline_             total_balance_of_recent_satisfactory_open_trades_f =    _sgl_quote_c -2 _sgl_quote_   _newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades==-1    _newline_             total_balance_of_recent_satisfactory_open_trades_f =    _sgl_quote_d -1 _sgl_quote_   _newline_        end_newline_        if (total_balance_of_recent_satisfactory_open_trades >= 0 and total_balance_of_recent_satisfactory_open_trades <= 13066)   _newline_             total_balance_of_recent_satisfactory_open_trades_f =    _sgl_quote_e 0 - 13066 _sgl_quote_    _newline_        end_newline_        if (total_balance_of_recent_satisfactory_open_trades > 13066 and total_balance_of_recent_satisfactory_open_trades <= 43181)    _newline_             total_balance_of_recent_satisfactory_open_trades_f =    _sgl_quote_f 13067 - 43181 _sgl_quote_    _newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades>43181   _newline_             total_balance_of_recent_satisfactory_open_trades_f =    _sgl_quote_g 43182 + _sgl_quote_    _newline_        end_newline_                  _newline_        if total_balance_of_recent_satisfactory_open_trades_cellular==-6    _newline_             total_balance_of_recent_satisfactory_open_trades_cellular_f =    _sgl_quote_a -6 _sgl_quote_   _newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades_cellular==-5    _newline_             total_balance_of_recent_satisfactory_open_trades_cellular_f =    _sgl_quote_b -5 _sgl_quote_   _newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades_cellular==-2    _newline_             total_balance_of_recent_satisfactory_open_trades_cellular_f =    _sgl_quote_c -2 _sgl_quote_   _newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades_cellular==-1    _newline_             total_balance_of_recent_satisfactory_open_trades_cellular_f =    _sgl_quote_d -1 _sgl_quote_   _newline_        end_newline_        if (total_balance_of_recent_satisfactory_open_trades_cellular >= 0 and total_balance_of_recent_satisfactory_open_trades_cellular <= 567)   _newline_             total_balance_of_recent_satisfactory_open_trades_cellular_f =    _sgl_quote_e 0 - 567 _sgl_quote_    _newline_        end_newline_        if (total_balance_of_recent_satisfactory_open_trades_cellular > 567 and total_balance_of_recent_satisfactory_open_trades_cellular <= 1268)   _newline_             total_balance_of_recent_satisfactory_open_trades_cellular_f =    _sgl_quote_f 568 - 1268 _sgl_quote_   _newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades_cellular>1268    _newline_             total_balance_of_recent_satisfactory_open_trades_cellular_f =    _sgl_quote_g 1269 + _sgl_quote_   _newline_        end_newline_                  _newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc==-5    _newline_             average_utilisation_of_open_trades_over_last_3_months_for_cc_f =    _sgl_quote_a -5 _sgl_quote_   _newline_        end_newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc==-4    _newline_             average_utilisation_of_open_trades_over_last_3_months_for_cc_f =    _sgl_quote_b -4 _sgl_quote_   _newline_        end_newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc==-2    _newline_             average_utilisation_of_open_trades_over_last_3_months_for_cc_f =    _sgl_quote_c -2 _sgl_quote_   _newline_        end_newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc==-1    _newline_             average_utilisation_of_open_trades_over_last_3_months_for_cc_f =    _sgl_quote_d -1 _sgl_quote_   _newline_        end_newline_        if (average_utilisation_of_open_trades_over_last_3_months_for_cc >= 0 and average_utilisation_of_open_trades_over_last_3_months_for_cc <= 64)    _newline_             average_utilisation_of_open_trades_over_last_3_months_for_cc_f =    _sgl_quote_e 0 - 64 _sgl_quote_   _newline_        end_newline_        if (average_utilisation_of_open_trades_over_last_3_months_for_cc > 64 and average_utilisation_of_open_trades_over_last_3_months_for_cc <= 97)    _newline_             average_utilisation_of_open_trades_over_last_3_months_for_cc_f =    _sgl_quote_f 65 - 97 _sgl_quote_    _newline_        end_newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc>97    _newline_             average_utilisation_of_open_trades_over_last_3_months_for_cc_f =    _sgl_quote_g 98 + _sgl_quote_   _newline_        end_newline_                  _newline_        if any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears==0   _newline_             any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears_f =    _sgl_quote_a 0 _sgl_quote_    _newline_        end_newline_        if any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears>0   _newline_             any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears_f =    _sgl_quote_b 1 + _sgl_quote_    _newline_        end_newline_    _newline_      #**** 7. apply woe code (just for reference) *********_newline_    _newline_        if age_of_oldest_open_trade_cellular==-5 _newline_           age_of_oldest_open_trade_cellular_woe=0_newline_        end_newline_        if age_of_oldest_open_trade_cellular==-2 _newline_           age_of_oldest_open_trade_cellular_woe=-13.6391_newline_        end_newline_        if age_of_oldest_open_trade_cellular==-1 _newline_           age_of_oldest_open_trade_cellular_woe=0_newline_        end_newline_        if (age_of_oldest_open_trade_cellular >= 0 and age_of_oldest_open_trade_cellular <= 46) _newline_           age_of_oldest_open_trade_cellular_woe=-41.9789_newline_        end_newline_        if (age_of_oldest_open_trade_cellular > 46 and age_of_oldest_open_trade_cellular <= 101) _newline_           age_of_oldest_open_trade_cellular_woe=41.5237_newline_        end_newline_        if age_of_oldest_open_trade_cellular>101 _newline_           age_of_oldest_open_trade_cellular_woe=66.2526_newline_        end_newline_            _newline_        if new_variable_number_of_enquiries_in_the_past_12_months_general_accounts==-2 _newline_           new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_woe=0_newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_12_months_general_accounts==-1 _newline_           new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_woe=0_newline_        end_newline_        if (new_variable_number_of_enquiries_in_the_past_12_months_general_accounts >= 0 and new_variable_number_of_enquiries_in_the_past_12_months_general_accounts <=1)_newline_           new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_woe=0_newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_12_months_general_accounts==2 _newline_           new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_woe=0_newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_12_months_general_accounts>2 _newline_           new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_woe=1_newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans==-2 _newline_           new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_woe=35.2428_newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans==-1 _newline_           new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_woe=80.0119_newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans==0 _newline_           new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_woe=-27.1503_newline_        end_newline_        if (new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans > 0 and new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans <= 2) _newline_           new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_woe=-104.1265_newline_        end_newline_        if new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans>2 _newline_           new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_woe=-155.9218_newline_        end_newline_    _newline_        if number_of_trades_opened_in_past_6_months_all_industries==-1 _newline_           number_of_trades_opened_in_past_6_months_all_industries_woe=0_newline_        end_newline_        if number_of_trades_opened_in_past_6_months_all_industries==0 _newline_           number_of_trades_opened_in_past_6_months_all_industries_woe=61.4869_newline_        end_newline_        if (number_of_trades_opened_in_past_6_months_all_industries > 0 and number_of_trades_opened_in_past_6_months_all_industries <= 2) _newline_           number_of_trades_opened_in_past_6_months_all_industries_woe=-21.8999_newline_        end_newline_        if number_of_trades_opened_in_past_6_months_all_industries==3 _newline_           number_of_trades_opened_in_past_6_months_all_industries_woe=-92.8855_newline_        end_newline_        if number_of_trades_opened_in_past_6_months_all_industries>3 _newline_           number_of_trades_opened_in_past_6_months_all_industries_woe=-150.5284_newline_        end_newline_    _newline_        if total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card==-5 _newline_           total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_woe=0_newline_        end_newline_        if total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card==-2 _newline_           total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_woe=0_newline_        end_newline_        if total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card==-1 _newline_           total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_woe=0_newline_        end_newline_        if (total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card >= 0 and total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card <= 740) _newline_           total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_woe=69.0014_newline_        end_newline_        if total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card>740 _newline_           total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_woe=-4.7893_newline_        end_newline_    _newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all==-7 _newline_           pecent_increase_in_average_payment_from_month_0_to_12_for_all_woe=16.1383_newline_        end_newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all==-5 _newline_           pecent_increase_in_average_payment_from_month_0_to_12_for_all_woe=0_newline_        end_newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all==-4 _newline_           pecent_increase_in_average_payment_from_month_0_to_12_for_all_woe=0_newline_        end_newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all==-1 _newline_           pecent_increase_in_average_payment_from_month_0_to_12_for_all_woe=-32.2083_newline_        end_newline_        if (pecent_increase_in_average_payment_from_month_0_to_12_for_all >= 0 and pecent_increase_in_average_payment_from_month_0_to_12_for_all <= 34) _newline_           pecent_increase_in_average_payment_from_month_0_to_12_for_all_woe=36.2905_newline_        end_newline_        if pecent_increase_in_average_payment_from_month_0_to_12_for_all>34 _newline_           pecent_increase_in_average_payment_from_month_0_to_12_for_all_woe=-44.2948_newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades==-6 _newline_           total_balance_of_recent_satisfactory_open_trades_woe=-74.4644_newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades==-5 _newline_           total_balance_of_recent_satisfactory_open_trades_woe=19.851_newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades==-2 _newline_           total_balance_of_recent_satisfactory_open_trades_woe=43.1734_newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades==-1 _newline_           total_balance_of_recent_satisfactory_open_trades_woe=0_newline_        end       _newline_        if (total_balance_of_recent_satisfactory_open_trades >= 0 and total_balance_of_recent_satisfactory_open_trades <= 13066) _newline_           total_balance_of_recent_satisfactory_open_trades_woe=27.9874_newline_        end_newline_        if (total_balance_of_recent_satisfactory_open_trades > 0 and total_balance_of_recent_satisfactory_open_trades <= 43181) _newline_           total_balance_of_recent_satisfactory_open_trades_woe=-43.4521_newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades>43181 _newline_           total_balance_of_recent_satisfactory_open_trades_woe=-94.1651_newline_        end_newline_    _newline_        if total_balance_of_recent_satisfactory_open_trades_cellular==-6 _newline_           total_balance_of_recent_satisfactory_open_trades_cellular_woe=-43.7292_newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades_cellular==-5 _newline_           total_balance_of_recent_satisfactory_open_trades_cellular_woe=0_newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades_cellular==-2 _newline_           total_balance_of_recent_satisfactory_open_trades_cellular_woe=0_newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades_cellular==-1 _newline_           total_balance_of_recent_satisfactory_open_trades_cellular_woe=0_newline_        end_newline_        if (total_balance_of_recent_satisfactory_open_trades_cellular >= 0 and total_balance_of_recent_satisfactory_open_trades_cellular <= 567) _newline_           total_balance_of_recent_satisfactory_open_trades_cellular_woe=22.2412_newline_        end_newline_        if (total_balance_of_recent_satisfactory_open_trades_cellular > 567 and total_balance_of_recent_satisfactory_open_trades_cellular <= 1268) _newline_           total_balance_of_recent_satisfactory_open_trades_cellular_woe=12.5589_newline_        end_newline_        if total_balance_of_recent_satisfactory_open_trades_cellular>1268 _newline_           total_balance_of_recent_satisfactory_open_trades_cellular_woe=-33.358_newline_        end_newline_    _newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc==-5 _newline_           average_utilisation_of_open_trades_over_last_3_months_for_cc_woe=0_newline_        end_newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc==-4 _newline_           average_utilisation_of_open_trades_over_last_3_months_for_cc_woe=0_newline_        end_newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc==-2 _newline_           average_utilisation_of_open_trades_over_last_3_months_for_cc_woe=-26.4805_newline_        end_newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc==-1 _newline_           average_utilisation_of_open_trades_over_last_3_months_for_cc_woe=0_newline_        end_newline_        if (average_utilisation_of_open_trades_over_last_3_months_for_cc >= 0 and average_utilisation_of_open_trades_over_last_3_months_for_cc <= 64) _newline_           average_utilisation_of_open_trades_over_last_3_months_for_cc_woe=65.8282_newline_        end_newline_        if (average_utilisation_of_open_trades_over_last_3_months_for_cc > 64 and average_utilisation_of_open_trades_over_last_3_months_for_cc <= 97) _newline_           average_utilisation_of_open_trades_over_last_3_months_for_cc_woe=-8.1566_newline_        end_newline_        if average_utilisation_of_open_trades_over_last_3_months_for_cc>97 _newline_           average_utilisation_of_open_trades_over_last_3_months_for_cc_woe=-65.5924_newline_        end_newline_    _newline_        if any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears==0 _newline_           any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears_woe=5.1449_newline_        end_newline_        if any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears>0 _newline_           any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears_woe=-66.1144_newline_        end    _newline_    _newline_      #**** 7. apply estimates (just for reference) *********_newline_    _newline_        intercept=4.210137489_newline_        new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_estimate =0.0065192219_newline_        new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_estimate =-0.898053516_newline_        pecent_increase_in_average_payment_from_month_0_to_12_for_all_estimate =0.007947053_newline_        average_utilisation_of_open_trades_over_last_3_months_for_cc_estimate =0.0058488741_newline_        number_of_trades_opened_in_past_6_months_all_industries_estimate =0.0047780405_newline_        age_of_oldest_open_trade_cellular_estimate =0.0089262495_newline_        total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_estimate =0.0073585635_newline_        total_balance_of_recent_satisfactory_open_trades_cellular_estimate =0.0103695205_newline_        total_balance_of_recent_satisfactory_open_trades_estimate =0.0047062869_newline_        any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears_estimate =0.0057271598_newline_    _newline_    end #if to_be_scored = _quote_yes_quote_ then do_newline_    _newline_    _newline_    # 8.   ensure scores are not assigned for consumers that fail the filters_newline_    _newline_    if to_be_scored != _sgl_quote_yes_sgl_quote_ _newline_          bcc_band_scaled_ri = _sgl_quote_filter_sgl_quote__newline_          scaled_score_bcc = nil_newline_            intercept = nil_newline_        age_of_oldest_open_trade_cellular_score = nil_newline_        new_variable_number_of_enquiries_in_the_past_6_months_finance_house_loans_score = nil_newline_        new_variable_number_of_enquiries_in_the_past_12_months_general_accounts_score = nil_newline_        pecent_increase_in_average_payment_from_month_0_to_12_for_all_score = nil_newline_        average_utilisation_of_open_trades_over_last_3_months_for_cc_score = nil_newline_        number_of_trades_opened_in_past_6_months_all_industries_score = nil_newline_        total_monthly_payment_of_open_trades_as_of_18_months_ago_credit_card_score = nil_newline_        total_balance_of_recent_satisfactory_open_trades_cellular_score = nil_newline_        total_balance_of_recent_satisfactory_open_trades_score = nil_newline_        any_default_or_judgment_or_write_off_or_collections_trade_or_vaf_trade_6_to_9_months_in_arrears_score = nil_newline_      _newline_    end #if to_be_scored ne _quote_yes_quote_ then do_newline_#run_newline_#    if scaled_score_bcc.nil?_newline_#      scaled_bcc_score = nil_newline_#    else_newline_#      scaled_bcc_score = scaled_score_bcc_newline_#    end_newline__newline_    Variables::outputs.ToBeScored = to_be_scored.to_s_newline__newline_    if scaled_score_bcc.nil?_newline_      Variables::outputs.ScaledBCCScore = nil_newline_      Messages.AddInfo(_quote_nil_quote_)_newline_    else_newline_      Variables::outputs.ScaledBCCScore = scaled_score_bcc_newline_      Messages.AddInfo(scaled_score_bcc.to_s)_newline_    end_newline__newline__newline__newline_#puts _sgl_quote_To be scored: _sgl_quote_ + to_be_scored.to_s_newline_#puts _sgl_quote_Saled BCC Score: _sgl_quote_ + scaled_bcc_score.to_s _newline__newline_")},{-4, new Node(-4,"End",NodeType.End,@"")}};
            this.systemMessageCollection = messages;
            SubtreeMessagesDictionary = new Dictionary<string, ISystemMessageCollection>();
            SubtreeMessagesToClear = new List<string>();
        }		
    }
}